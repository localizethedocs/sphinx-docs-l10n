
<!DOCTYPE html>

<html lang="en_US">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>sphinx.domains.python &#8212; Sphinx documentation</title>
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/sphinx13.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css" />
    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <link rel="canonical" href="https://projects.localizethedocs.org/sphinx-docs-l10n/_modules/sphinx/domains/python.html" />
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within Sphinx documentation"
          href="../../../_static/opensearch.xml"/>
    <link rel="shortcut icon" href="../../../_static/favicon.svg"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />

    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300,400,700'
          rel='stylesheet' type='text/css' />
 
    <style type="text/css">
      table.right { float: right; margin-left: 20px; }
      table.right td { border: 1px solid #ccc; }
      
    </style>
    <script>
      // intelligent scrolling of the sidebar content
      $(window).scroll(function() {
        var sb = $('.sphinxsidebarwrapper');
        var win = $(window);
        var sbh = sb.height();
        var offset = $('.sphinxsidebar').position()['top'];
        var wintop = win.scrollTop();
        var winbot = wintop + win.innerHeight();
        var curtop = sb.position()['top'];
        var curbot = curtop + sbh;
        // does sidebar fit in window?
        if (sbh < win.innerHeight()) {
          // yes: easy case -- always keep at the top
          sb.css('top', $u.min([$u.max([0, wintop - offset - 10]),
                                $(document).height() - sbh - 200]));
        } else {
          // no: only scroll if top/bottom edge of sidebar is at
          // top/bottom edge of window
          if (curtop > wintop && curbot > winbot) {
            sb.css('top', $u.max([wintop - offset - 10, 0]));
          } else if (curtop < wintop && curbot < winbot) {
            sb.css('top', $u.min([winbot - sbh - offset - 20,
                                  $(document).height() - sbh - 200]));
          }
        }
      });
    </script>

<script type="text/javascript" src="../../../ltd-provenance.js"></script>
<script type="text/javascript" src="../../../ltd-current.js"></script>
<script type="text/javascript" src="../../../../../ltd-config.js"></script>
<script type="text/javascript" src="../../../../../ltd-flyout.js"></script>

  </head><body>
<div class="pageheader">
  <ul>
    <li><a href="../../../index.html">Home</a></li>
    <li><a href="../../../usage/installation.html">Get it</a></li>
    <li><a href="../../../contents.html">Docs</a></li>
    <li><a href="../../../development/index.html">Extend</a></li>
  </ul>
  <div>
    <a href="../../../index.html">
      <img src="../../../_static/sphinxheader.png" alt="SPHINX" />
    </a>
  </div>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">Sphinx home</a>&#160;|</li>
        <li><a href="../../../contents.html">Documentation</a> &#187;</li>

          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../domains.html" accesskey="U">sphinx.domains</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">sphinx.domains.python</a></li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for sphinx.domains.python</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    sphinx.domains.python</span>
<span class="sd">    ~~~~~~~~~~~~~~~~~~~~~</span>

<span class="sd">    The Python domain.</span>

<span class="sd">    :copyright: Copyright 2007-2021 by the Sphinx team, see AUTHORS.</span>
<span class="sd">    :license: BSD, see LICENSE for details.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">builtins</span>
<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">typing</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">inspect</span> <span class="kn">import</span> <span class="n">Parameter</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">,</span> <span class="n">Iterator</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">NamedTuple</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">cast</span>

<span class="kn">from</span> <span class="nn">docutils</span> <span class="kn">import</span> <span class="n">nodes</span>
<span class="kn">from</span> <span class="nn">docutils.nodes</span> <span class="kn">import</span> <span class="n">Element</span><span class="p">,</span> <span class="n">Node</span>
<span class="kn">from</span> <span class="nn">docutils.parsers.rst</span> <span class="kn">import</span> <span class="n">directives</span>

<span class="kn">from</span> <span class="nn">sphinx</span> <span class="kn">import</span> <span class="n">addnodes</span>
<span class="kn">from</span> <span class="nn">sphinx.addnodes</span> <span class="kn">import</span> <span class="n">desc_signature</span><span class="p">,</span> <span class="n">pending_xref</span>
<span class="kn">from</span> <span class="nn">sphinx.application</span> <span class="kn">import</span> <span class="n">Sphinx</span>
<span class="kn">from</span> <span class="nn">sphinx.builders</span> <span class="kn">import</span> <span class="n">Builder</span>
<span class="kn">from</span> <span class="nn">sphinx.deprecation</span> <span class="kn">import</span> <span class="n">RemovedInSphinx40Warning</span><span class="p">,</span> <span class="n">RemovedInSphinx50Warning</span>
<span class="kn">from</span> <span class="nn">sphinx.directives</span> <span class="kn">import</span> <span class="n">ObjectDescription</span>
<span class="kn">from</span> <span class="nn">sphinx.domains</span> <span class="kn">import</span> <span class="n">Domain</span><span class="p">,</span> <span class="n">Index</span><span class="p">,</span> <span class="n">IndexEntry</span><span class="p">,</span> <span class="n">ObjType</span>
<span class="kn">from</span> <span class="nn">sphinx.environment</span> <span class="kn">import</span> <span class="n">BuildEnvironment</span>
<span class="kn">from</span> <span class="nn">sphinx.locale</span> <span class="kn">import</span> <span class="n">_</span><span class="p">,</span> <span class="n">__</span>
<span class="kn">from</span> <span class="nn">sphinx.pycode.ast</span> <span class="kn">import</span> <span class="n">ast</span>
<span class="kn">from</span> <span class="nn">sphinx.pycode.ast</span> <span class="kn">import</span> <span class="n">parse</span> <span class="k">as</span> <span class="n">ast_parse</span>
<span class="kn">from</span> <span class="nn">sphinx.roles</span> <span class="kn">import</span> <span class="n">XRefRole</span>
<span class="kn">from</span> <span class="nn">sphinx.util</span> <span class="kn">import</span> <span class="n">logging</span>
<span class="kn">from</span> <span class="nn">sphinx.util.docfields</span> <span class="kn">import</span> <span class="n">Field</span><span class="p">,</span> <span class="n">GroupedField</span><span class="p">,</span> <span class="n">TypedField</span>
<span class="kn">from</span> <span class="nn">sphinx.util.docutils</span> <span class="kn">import</span> <span class="n">SphinxDirective</span>
<span class="kn">from</span> <span class="nn">sphinx.util.inspect</span> <span class="kn">import</span> <span class="n">signature_from_str</span>
<span class="kn">from</span> <span class="nn">sphinx.util.nodes</span> <span class="kn">import</span> <span class="n">make_id</span><span class="p">,</span> <span class="n">make_refnode</span>
<span class="kn">from</span> <span class="nn">sphinx.util.typing</span> <span class="kn">import</span> <span class="n">TextlikeNode</span>

<span class="k">if</span> <span class="kc">False</span><span class="p">:</span>
    <span class="c1"># For type annotation</span>
    <span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Type</span>  <span class="c1"># for python3.5.1</span>


<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<span class="c1"># REs for Python signatures</span>
<span class="n">py_sig_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;^ ([\w.]*\.)?            # class name(s)</span>
<span class="sd">          (\w+)  \s*             # thing name</span>
<span class="sd">          (?: \(\s*(.*)\s*\)     # optional: arguments</span>
<span class="sd">           (?:\s* -&gt; \s* (.*))?  #           return annotation</span>
<span class="sd">          )? $                   # and nothing more</span>
<span class="sd">          &#39;&#39;&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">VERBOSE</span><span class="p">)</span>


<span class="n">pairindextypes</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;module&#39;</span><span class="p">:</span>    <span class="n">_</span><span class="p">(</span><span class="s1">&#39;module&#39;</span><span class="p">),</span>
    <span class="s1">&#39;keyword&#39;</span><span class="p">:</span>   <span class="n">_</span><span class="p">(</span><span class="s1">&#39;keyword&#39;</span><span class="p">),</span>
    <span class="s1">&#39;operator&#39;</span><span class="p">:</span>  <span class="n">_</span><span class="p">(</span><span class="s1">&#39;operator&#39;</span><span class="p">),</span>
    <span class="s1">&#39;object&#39;</span><span class="p">:</span>    <span class="n">_</span><span class="p">(</span><span class="s1">&#39;object&#39;</span><span class="p">),</span>
    <span class="s1">&#39;exception&#39;</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;exception&#39;</span><span class="p">),</span>
    <span class="s1">&#39;statement&#39;</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;statement&#39;</span><span class="p">),</span>
    <span class="s1">&#39;builtin&#39;</span><span class="p">:</span>   <span class="n">_</span><span class="p">(</span><span class="s1">&#39;built-in function&#39;</span><span class="p">),</span>
<span class="p">}</span>

<span class="n">ObjectEntry</span> <span class="o">=</span> <span class="n">NamedTuple</span><span class="p">(</span><span class="s1">&#39;ObjectEntry&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;docname&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span>
                                         <span class="p">(</span><span class="s1">&#39;node_id&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span>
                                         <span class="p">(</span><span class="s1">&#39;objtype&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">)])</span>
<span class="n">ModuleEntry</span> <span class="o">=</span> <span class="n">NamedTuple</span><span class="p">(</span><span class="s1">&#39;ModuleEntry&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;docname&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span>
                                         <span class="p">(</span><span class="s1">&#39;node_id&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span>
                                         <span class="p">(</span><span class="s1">&#39;synopsis&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span>
                                         <span class="p">(</span><span class="s1">&#39;platform&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span>
                                         <span class="p">(</span><span class="s1">&#39;deprecated&#39;</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)])</span>


<span class="k">def</span> <span class="nf">type_to_xref</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">env</span><span class="p">:</span> <span class="n">BuildEnvironment</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">addnodes</span><span class="o">.</span><span class="n">pending_xref</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert a type string to a cross reference node.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">text</span> <span class="o">==</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span>
        <span class="n">reftype</span> <span class="o">=</span> <span class="s1">&#39;obj&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">reftype</span> <span class="o">=</span> <span class="s1">&#39;class&#39;</span>

    <span class="k">if</span> <span class="n">env</span><span class="p">:</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;py:module&#39;</span><span class="p">:</span> <span class="n">env</span><span class="o">.</span><span class="n">ref_context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;py:module&#39;</span><span class="p">),</span>
                  <span class="s1">&#39;py:class&#39;</span><span class="p">:</span> <span class="n">env</span><span class="o">.</span><span class="n">ref_context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;py:class&#39;</span><span class="p">)}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">return</span> <span class="n">pending_xref</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="n">text</span><span class="p">),</span>
                        <span class="n">refdomain</span><span class="o">=</span><span class="s1">&#39;py&#39;</span><span class="p">,</span> <span class="n">reftype</span><span class="o">=</span><span class="n">reftype</span><span class="p">,</span> <span class="n">reftarget</span><span class="o">=</span><span class="n">text</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_parse_annotation</span><span class="p">(</span><span class="n">annotation</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">env</span><span class="p">:</span> <span class="n">BuildEnvironment</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Node</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse type annotation.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">unparse</span><span class="p">(</span><span class="n">node</span><span class="p">:</span> <span class="n">ast</span><span class="o">.</span><span class="n">AST</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Node</span><span class="p">]:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Attribute</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">nodes</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">unparse</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">value</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">node</span><span class="o">.</span><span class="n">attr</span><span class="p">))]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">BinOp</span><span class="p">):</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">unparse</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">left</span><span class="p">)</span>  <span class="c1"># type: List[Node]</span>
            <span class="n">result</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">unparse</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">op</span><span class="p">))</span>
            <span class="n">result</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">unparse</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">right</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">result</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">BitOr</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">nodes</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">),</span> <span class="n">addnodes</span><span class="o">.</span><span class="n">desc_sig_punctuation</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;|&#39;</span><span class="p">),</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Expr</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">unparse</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Index</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">unparse</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">List</span><span class="p">):</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="n">addnodes</span><span class="o">.</span><span class="n">desc_sig_punctuation</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;[&#39;</span><span class="p">)]</span>
            <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">elts</span><span class="p">:</span>
                <span class="n">result</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">unparse</span><span class="p">(</span><span class="n">elem</span><span class="p">))</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">addnodes</span><span class="o">.</span><span class="n">desc_sig_punctuation</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;, &#39;</span><span class="p">))</span>
            <span class="n">result</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">addnodes</span><span class="o">.</span><span class="n">desc_sig_punctuation</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;]&#39;</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">result</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">sum</span><span class="p">((</span><span class="n">unparse</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">body</span><span class="p">),</span> <span class="p">[])</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">nodes</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="p">)]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Subscript</span><span class="p">):</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">unparse</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">addnodes</span><span class="o">.</span><span class="n">desc_sig_punctuation</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;[&#39;</span><span class="p">))</span>
            <span class="n">result</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">unparse</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">slice</span><span class="p">))</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">addnodes</span><span class="o">.</span><span class="n">desc_sig_punctuation</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;]&#39;</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">result</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Tuple</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">elts</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">elts</span><span class="p">:</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">unparse</span><span class="p">(</span><span class="n">elem</span><span class="p">))</span>
                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">addnodes</span><span class="o">.</span><span class="n">desc_sig_punctuation</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;, &#39;</span><span class="p">))</span>
                <span class="n">result</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="n">addnodes</span><span class="o">.</span><span class="n">desc_sig_punctuation</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;(&#39;</span><span class="p">),</span>
                          <span class="n">addnodes</span><span class="o">.</span><span class="n">desc_sig_punctuation</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;)&#39;</span><span class="p">)]</span>

            <span class="k">return</span> <span class="n">result</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Constant</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="bp">Ellipsis</span><span class="p">:</span>
                        <span class="k">return</span> <span class="p">[</span><span class="n">addnodes</span><span class="o">.</span><span class="n">desc_sig_punctuation</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s2">&quot;...&quot;</span><span class="p">)]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">return</span> <span class="p">[</span><span class="n">nodes</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">value</span><span class="p">)]</span>

            <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">8</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Ellipsis</span><span class="p">):</span>
                    <span class="k">return</span> <span class="p">[</span><span class="n">addnodes</span><span class="o">.</span><span class="n">desc_sig_punctuation</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s2">&quot;...&quot;</span><span class="p">)]</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">NameConstant</span><span class="p">):</span>
                    <span class="k">return</span> <span class="p">[</span><span class="n">nodes</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">value</span><span class="p">)]</span>

            <span class="k">raise</span> <span class="ne">SyntaxError</span>  <span class="c1"># unsupported syntax</span>

    <span class="k">if</span> <span class="n">env</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;The env parameter for _parse_annotation becomes required now.&quot;</span><span class="p">,</span>
                      <span class="n">RemovedInSphinx50Warning</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="n">ast_parse</span><span class="p">(</span><span class="n">annotation</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">unparse</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">node</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">result</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Text</span><span class="p">)</span> <span class="ow">and</span> <span class="n">node</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                <span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">type_to_xref</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">node</span><span class="p">),</span> <span class="n">env</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>
    <span class="k">except</span> <span class="ne">SyntaxError</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">type_to_xref</span><span class="p">(</span><span class="n">annotation</span><span class="p">,</span> <span class="n">env</span><span class="p">)]</span>


<span class="k">def</span> <span class="nf">_parse_arglist</span><span class="p">(</span><span class="n">arglist</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">env</span><span class="p">:</span> <span class="n">BuildEnvironment</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">addnodes</span><span class="o">.</span><span class="n">desc_parameterlist</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse a list of arguments using AST parser&quot;&quot;&quot;</span>
    <span class="n">params</span> <span class="o">=</span> <span class="n">addnodes</span><span class="o">.</span><span class="n">desc_parameterlist</span><span class="p">(</span><span class="n">arglist</span><span class="p">)</span>
    <span class="n">sig</span> <span class="o">=</span> <span class="n">signature_from_str</span><span class="p">(</span><span class="s1">&#39;(</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="n">arglist</span><span class="p">)</span>
    <span class="n">last_kind</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">sig</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">param</span><span class="o">.</span><span class="n">kind</span> <span class="o">!=</span> <span class="n">param</span><span class="o">.</span><span class="n">POSITIONAL_ONLY</span> <span class="ow">and</span> <span class="n">last_kind</span> <span class="o">==</span> <span class="n">param</span><span class="o">.</span><span class="n">POSITIONAL_ONLY</span><span class="p">:</span>
            <span class="c1"># PEP-570: Separator for Positional Only Parameter: /</span>
            <span class="n">params</span> <span class="o">+=</span> <span class="n">addnodes</span><span class="o">.</span><span class="n">desc_parameter</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">addnodes</span><span class="o">.</span><span class="n">desc_sig_operator</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">param</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="n">param</span><span class="o">.</span><span class="n">KEYWORD_ONLY</span> <span class="ow">and</span> <span class="n">last_kind</span> <span class="ow">in</span> <span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">POSITIONAL_OR_KEYWORD</span><span class="p">,</span>
                                                              <span class="n">param</span><span class="o">.</span><span class="n">POSITIONAL_ONLY</span><span class="p">,</span>
                                                              <span class="kc">None</span><span class="p">):</span>
            <span class="c1"># PEP-3102: Separator for Keyword Only Parameter: *</span>
            <span class="n">params</span> <span class="o">+=</span> <span class="n">addnodes</span><span class="o">.</span><span class="n">desc_parameter</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">addnodes</span><span class="o">.</span><span class="n">desc_sig_operator</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">))</span>

        <span class="n">node</span> <span class="o">=</span> <span class="n">addnodes</span><span class="o">.</span><span class="n">desc_parameter</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">param</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="n">param</span><span class="o">.</span><span class="n">VAR_POSITIONAL</span><span class="p">:</span>
            <span class="n">node</span> <span class="o">+=</span> <span class="n">addnodes</span><span class="o">.</span><span class="n">desc_sig_operator</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">)</span>
            <span class="n">node</span> <span class="o">+=</span> <span class="n">addnodes</span><span class="o">.</span><span class="n">desc_sig_name</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">param</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">param</span><span class="o">.</span><span class="n">kind</span> <span class="o">==</span> <span class="n">param</span><span class="o">.</span><span class="n">VAR_KEYWORD</span><span class="p">:</span>
            <span class="n">node</span> <span class="o">+=</span> <span class="n">addnodes</span><span class="o">.</span><span class="n">desc_sig_operator</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;**&#39;</span><span class="p">)</span>
            <span class="n">node</span> <span class="o">+=</span> <span class="n">addnodes</span><span class="o">.</span><span class="n">desc_sig_name</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">param</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">node</span> <span class="o">+=</span> <span class="n">addnodes</span><span class="o">.</span><span class="n">desc_sig_name</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">param</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">param</span><span class="o">.</span><span class="n">annotation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">param</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">children</span> <span class="o">=</span> <span class="n">_parse_annotation</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">annotation</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
            <span class="n">node</span> <span class="o">+=</span> <span class="n">addnodes</span><span class="o">.</span><span class="n">desc_sig_punctuation</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">)</span>
            <span class="n">node</span> <span class="o">+=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
            <span class="n">node</span> <span class="o">+=</span> <span class="n">addnodes</span><span class="o">.</span><span class="n">desc_sig_name</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">children</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
        <span class="k">if</span> <span class="n">param</span><span class="o">.</span><span class="n">default</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">param</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">param</span><span class="o">.</span><span class="n">annotation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">param</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="n">node</span> <span class="o">+=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                <span class="n">node</span> <span class="o">+=</span> <span class="n">addnodes</span><span class="o">.</span><span class="n">desc_sig_operator</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">)</span>
                <span class="n">node</span> <span class="o">+=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">node</span> <span class="o">+=</span> <span class="n">addnodes</span><span class="o">.</span><span class="n">desc_sig_operator</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">)</span>
            <span class="n">node</span> <span class="o">+=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">inline</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">param</span><span class="o">.</span><span class="n">default</span><span class="p">,</span> <span class="n">classes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;default_value&#39;</span><span class="p">],</span>
                                 <span class="n">support_smartquotes</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">params</span> <span class="o">+=</span> <span class="n">node</span>
        <span class="n">last_kind</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">kind</span>

    <span class="k">if</span> <span class="n">last_kind</span> <span class="o">==</span> <span class="n">Parameter</span><span class="o">.</span><span class="n">POSITIONAL_ONLY</span><span class="p">:</span>
        <span class="c1"># PEP-570: Separator for Positional Only Parameter: /</span>
        <span class="n">params</span> <span class="o">+=</span> <span class="n">addnodes</span><span class="o">.</span><span class="n">desc_parameter</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">addnodes</span><span class="o">.</span><span class="n">desc_sig_operator</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">params</span>


<span class="k">def</span> <span class="nf">_pseudo_parse_arglist</span><span class="p">(</span><span class="n">signode</span><span class="p">:</span> <span class="n">desc_signature</span><span class="p">,</span> <span class="n">arglist</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;&quot;Parse&quot; a list of arguments separated by commas.</span>

<span class="sd">    Arguments can have &quot;optional&quot; annotations given by enclosing them in</span>
<span class="sd">    brackets.  Currently, this will split at any comma, even if it&#39;s inside a</span>
<span class="sd">    string literal (e.g. default argument value).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">paramlist</span> <span class="o">=</span> <span class="n">addnodes</span><span class="o">.</span><span class="n">desc_parameterlist</span><span class="p">()</span>
    <span class="n">stack</span> <span class="o">=</span> <span class="p">[</span><span class="n">paramlist</span><span class="p">]</span>  <span class="c1"># type: List[Element]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">argument</span> <span class="ow">in</span> <span class="n">arglist</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">):</span>
            <span class="n">argument</span> <span class="o">=</span> <span class="n">argument</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">ends_open</span> <span class="o">=</span> <span class="n">ends_close</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="n">argument</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">):</span>
                <span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">addnodes</span><span class="o">.</span><span class="n">desc_optional</span><span class="p">())</span>
                <span class="n">stack</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="n">stack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">argument</span> <span class="o">=</span> <span class="n">argument</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">while</span> <span class="n">argument</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;]&#39;</span><span class="p">):</span>
                <span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="n">argument</span> <span class="o">=</span> <span class="n">argument</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">while</span> <span class="n">argument</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;]&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">argument</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;[]&#39;</span><span class="p">):</span>
                <span class="n">ends_close</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">argument</span> <span class="o">=</span> <span class="n">argument</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">while</span> <span class="n">argument</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">):</span>
                <span class="n">ends_open</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">argument</span> <span class="o">=</span> <span class="n">argument</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">argument</span><span class="p">:</span>
                <span class="n">stack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">addnodes</span><span class="o">.</span><span class="n">desc_parameter</span><span class="p">(</span><span class="n">argument</span><span class="p">,</span> <span class="n">argument</span><span class="p">)</span>
            <span class="k">while</span> <span class="n">ends_open</span><span class="p">:</span>
                <span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">addnodes</span><span class="o">.</span><span class="n">desc_optional</span><span class="p">())</span>
                <span class="n">stack</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="n">stack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">ends_open</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="k">while</span> <span class="n">ends_close</span><span class="p">:</span>
                <span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="n">ends_close</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">stack</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IndexError</span>
    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
        <span class="c1"># if there are too few or too many elements on the stack, just give up</span>
        <span class="c1"># and treat the whole argument list as one argument, discarding the</span>
        <span class="c1"># already partially populated paramlist node</span>
        <span class="n">paramlist</span> <span class="o">=</span> <span class="n">addnodes</span><span class="o">.</span><span class="n">desc_parameterlist</span><span class="p">()</span>
        <span class="n">paramlist</span> <span class="o">+=</span> <span class="n">addnodes</span><span class="o">.</span><span class="n">desc_parameter</span><span class="p">(</span><span class="n">arglist</span><span class="p">,</span> <span class="n">arglist</span><span class="p">)</span>
        <span class="n">signode</span> <span class="o">+=</span> <span class="n">paramlist</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">signode</span> <span class="o">+=</span> <span class="n">paramlist</span>


<span class="c1"># This override allows our inline type specifiers to behave like :class: link</span>
<span class="c1"># when it comes to handling &quot;.&quot; and &quot;~&quot; prefixes.</span>
<span class="k">class</span> <span class="nc">PyXrefMixin</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">make_xref</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rolename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">domain</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                  <span class="n">innernode</span><span class="p">:</span> <span class="s2">&quot;Type[TextlikeNode]&quot;</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">emphasis</span><span class="p">,</span>
                  <span class="n">contnode</span><span class="p">:</span> <span class="n">Node</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">env</span><span class="p">:</span> <span class="n">BuildEnvironment</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Node</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">make_xref</span><span class="p">(</span><span class="n">rolename</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span>  <span class="c1"># type: ignore</span>
                                   <span class="n">innernode</span><span class="p">,</span> <span class="n">contnode</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
        <span class="n">result</span><span class="p">[</span><span class="s1">&#39;refspecific&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">result</span><span class="p">[</span><span class="s1">&#39;py:module&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">ref_context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;py:module&#39;</span><span class="p">)</span>
        <span class="n">result</span><span class="p">[</span><span class="s1">&#39;py:class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">ref_context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;py:class&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">target</span><span class="o">.</span><span class="n">startswith</span><span class="p">((</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;~&#39;</span><span class="p">)):</span>
            <span class="n">prefix</span><span class="p">,</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;reftarget&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">target</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">target</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="k">if</span> <span class="n">prefix</span> <span class="o">==</span> <span class="s1">&#39;.&#39;</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">=</span> <span class="n">target</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="k">elif</span> <span class="n">prefix</span> <span class="o">==</span> <span class="s1">&#39;~&#39;</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">traverse</span><span class="p">(</span><span class="n">nodes</span><span class="o">.</span><span class="n">Text</span><span class="p">):</span>
                <span class="n">node</span><span class="o">.</span><span class="n">parent</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">node</span><span class="p">)]</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
                <span class="k">break</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">make_xrefs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rolename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">domain</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                   <span class="n">innernode</span><span class="p">:</span> <span class="s2">&quot;Type[TextlikeNode]&quot;</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">emphasis</span><span class="p">,</span>
                   <span class="n">contnode</span><span class="p">:</span> <span class="n">Node</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">env</span><span class="p">:</span> <span class="n">BuildEnvironment</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Node</span><span class="p">]:</span>
        <span class="n">delims</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;(\s*[\[\]\(\),](?:\s*or\s)?\s*|\s+or\s+)&#39;</span>
        <span class="n">delims_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">delims</span><span class="p">)</span>
        <span class="n">sub_targets</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">delims</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>

        <span class="n">split_contnode</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">contnode</span> <span class="ow">and</span> <span class="n">contnode</span><span class="o">.</span><span class="n">astext</span><span class="p">()</span> <span class="o">==</span> <span class="n">target</span><span class="p">)</span>

        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">sub_target</span> <span class="ow">in</span> <span class="nb">filter</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">sub_targets</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">split_contnode</span><span class="p">:</span>
                <span class="n">contnode</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="n">sub_target</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">delims_re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">sub_target</span><span class="p">):</span>
                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">contnode</span> <span class="ow">or</span> <span class="n">innernode</span><span class="p">(</span><span class="n">sub_target</span><span class="p">,</span> <span class="n">sub_target</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">make_xref</span><span class="p">(</span><span class="n">rolename</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">sub_target</span><span class="p">,</span>
                                              <span class="n">innernode</span><span class="p">,</span> <span class="n">contnode</span><span class="p">,</span> <span class="n">env</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">results</span>


<span class="k">class</span> <span class="nc">PyField</span><span class="p">(</span><span class="n">PyXrefMixin</span><span class="p">,</span> <span class="n">Field</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">make_xref</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rolename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">domain</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                  <span class="n">innernode</span><span class="p">:</span> <span class="s2">&quot;Type[TextlikeNode]&quot;</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">emphasis</span><span class="p">,</span>
                  <span class="n">contnode</span><span class="p">:</span> <span class="n">Node</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">env</span><span class="p">:</span> <span class="n">BuildEnvironment</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Node</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">rolename</span> <span class="o">==</span> <span class="s1">&#39;class&#39;</span> <span class="ow">and</span> <span class="n">target</span> <span class="o">==</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span>
            <span class="c1"># None is not a type, so use obj role instead.</span>
            <span class="n">rolename</span> <span class="o">=</span> <span class="s1">&#39;obj&#39;</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">make_xref</span><span class="p">(</span><span class="n">rolename</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">innernode</span><span class="p">,</span> <span class="n">contnode</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">PyGroupedField</span><span class="p">(</span><span class="n">PyXrefMixin</span><span class="p">,</span> <span class="n">GroupedField</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">PyTypedField</span><span class="p">(</span><span class="n">PyXrefMixin</span><span class="p">,</span> <span class="n">TypedField</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">make_xref</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rolename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">domain</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                  <span class="n">innernode</span><span class="p">:</span> <span class="s2">&quot;Type[TextlikeNode]&quot;</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">emphasis</span><span class="p">,</span>
                  <span class="n">contnode</span><span class="p">:</span> <span class="n">Node</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">env</span><span class="p">:</span> <span class="n">BuildEnvironment</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Node</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">rolename</span> <span class="o">==</span> <span class="s1">&#39;class&#39;</span> <span class="ow">and</span> <span class="n">target</span> <span class="o">==</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span>
            <span class="c1"># None is not a type, so use obj role instead.</span>
            <span class="n">rolename</span> <span class="o">=</span> <span class="s1">&#39;obj&#39;</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">make_xref</span><span class="p">(</span><span class="n">rolename</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">innernode</span><span class="p">,</span> <span class="n">contnode</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">PyObject</span><span class="p">(</span><span class="n">ObjectDescription</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Description of a general Python object.</span>

<span class="sd">    :cvar allow_nesting: Class is an object that allows for nested namespaces</span>
<span class="sd">    :vartype allow_nesting: bool</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">option_spec</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;noindex&#39;</span><span class="p">:</span> <span class="n">directives</span><span class="o">.</span><span class="n">flag</span><span class="p">,</span>
        <span class="s1">&#39;noindexentry&#39;</span><span class="p">:</span> <span class="n">directives</span><span class="o">.</span><span class="n">flag</span><span class="p">,</span>
        <span class="s1">&#39;module&#39;</span><span class="p">:</span> <span class="n">directives</span><span class="o">.</span><span class="n">unchanged</span><span class="p">,</span>
        <span class="s1">&#39;annotation&#39;</span><span class="p">:</span> <span class="n">directives</span><span class="o">.</span><span class="n">unchanged</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">doc_field_types</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">PyTypedField</span><span class="p">(</span><span class="s1">&#39;parameter&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;Parameters&#39;</span><span class="p">),</span>
                     <span class="n">names</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;param&#39;</span><span class="p">,</span> <span class="s1">&#39;parameter&#39;</span><span class="p">,</span> <span class="s1">&#39;arg&#39;</span><span class="p">,</span> <span class="s1">&#39;argument&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;keyword&#39;</span><span class="p">,</span> <span class="s1">&#39;kwarg&#39;</span><span class="p">,</span> <span class="s1">&#39;kwparam&#39;</span><span class="p">),</span>
                     <span class="n">typerolename</span><span class="o">=</span><span class="s1">&#39;class&#39;</span><span class="p">,</span> <span class="n">typenames</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;paramtype&#39;</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">),</span>
                     <span class="n">can_collapse</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="n">PyTypedField</span><span class="p">(</span><span class="s1">&#39;variable&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;Variables&#39;</span><span class="p">),</span> <span class="n">rolename</span><span class="o">=</span><span class="s1">&#39;obj&#39;</span><span class="p">,</span>
                     <span class="n">names</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;var&#39;</span><span class="p">,</span> <span class="s1">&#39;ivar&#39;</span><span class="p">,</span> <span class="s1">&#39;cvar&#39;</span><span class="p">),</span>
                     <span class="n">typerolename</span><span class="o">=</span><span class="s1">&#39;class&#39;</span><span class="p">,</span> <span class="n">typenames</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;vartype&#39;</span><span class="p">,),</span>
                     <span class="n">can_collapse</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="n">PyGroupedField</span><span class="p">(</span><span class="s1">&#39;exceptions&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;Raises&#39;</span><span class="p">),</span> <span class="n">rolename</span><span class="o">=</span><span class="s1">&#39;exc&#39;</span><span class="p">,</span>
                       <span class="n">names</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;raises&#39;</span><span class="p">,</span> <span class="s1">&#39;raise&#39;</span><span class="p">,</span> <span class="s1">&#39;exception&#39;</span><span class="p">,</span> <span class="s1">&#39;except&#39;</span><span class="p">),</span>
                       <span class="n">can_collapse</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="n">Field</span><span class="p">(</span><span class="s1">&#39;returnvalue&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;Returns&#39;</span><span class="p">),</span> <span class="n">has_arg</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="n">names</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;returns&#39;</span><span class="p">,</span> <span class="s1">&#39;return&#39;</span><span class="p">)),</span>
        <span class="n">PyField</span><span class="p">(</span><span class="s1">&#39;returntype&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;Return type&#39;</span><span class="p">),</span> <span class="n">has_arg</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">names</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;rtype&#39;</span><span class="p">,),</span> <span class="n">bodyrolename</span><span class="o">=</span><span class="s1">&#39;class&#39;</span><span class="p">),</span>
    <span class="p">]</span>

    <span class="n">allow_nesting</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">get_signature_prefix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sig</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;May return a prefix to put before the object name in the</span>
<span class="sd">        signature.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s1">&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">needs_arglist</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;May return true if an empty argument list is to be generated even if</span>
<span class="sd">        the document contains none.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">handle_signature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sig</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">signode</span><span class="p">:</span> <span class="n">desc_signature</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Transform a Python signature into RST nodes.</span>

<span class="sd">        Return (fully qualified name of the thing, classname if any).</span>

<span class="sd">        If inside a class, the current class name is handled intelligently:</span>
<span class="sd">        * it is stripped from the displayed name if present</span>
<span class="sd">        * it is added to the full name (return value) if not present</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">py_sig_re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">sig</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">m</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span>
        <span class="n">prefix</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">arglist</span><span class="p">,</span> <span class="n">retann</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>

        <span class="c1"># determine module and class name (if applicable), as well as full name</span>
        <span class="n">modname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;module&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">ref_context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;py:module&#39;</span><span class="p">))</span>
        <span class="n">classname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">ref_context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;py:class&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">classname</span><span class="p">:</span>
            <span class="n">add_module</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="n">prefix</span> <span class="ow">and</span> <span class="p">(</span><span class="n">prefix</span> <span class="o">==</span> <span class="n">classname</span> <span class="ow">or</span>
                           <span class="n">prefix</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">classname</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span><span class="p">)):</span>
                <span class="n">fullname</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="n">name</span>
                <span class="c1"># class name is given again in the signature</span>
                <span class="n">prefix</span> <span class="o">=</span> <span class="n">prefix</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">classname</span><span class="p">):]</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">prefix</span><span class="p">:</span>
                <span class="c1"># class name is given in the signature, but different</span>
                <span class="c1"># (shouldn&#39;t happen)</span>
                <span class="n">fullname</span> <span class="o">=</span> <span class="n">classname</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">prefix</span> <span class="o">+</span> <span class="n">name</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># class name is not given in the signature</span>
                <span class="n">fullname</span> <span class="o">=</span> <span class="n">classname</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">add_module</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">prefix</span><span class="p">:</span>
                <span class="n">classname</span> <span class="o">=</span> <span class="n">prefix</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
                <span class="n">fullname</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> <span class="n">name</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">classname</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="n">fullname</span> <span class="o">=</span> <span class="n">name</span>

        <span class="n">signode</span><span class="p">[</span><span class="s1">&#39;module&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">modname</span>
        <span class="n">signode</span><span class="p">[</span><span class="s1">&#39;class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">classname</span>
        <span class="n">signode</span><span class="p">[</span><span class="s1">&#39;fullname&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fullname</span>

        <span class="n">sig_prefix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_signature_prefix</span><span class="p">(</span><span class="n">sig</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sig_prefix</span><span class="p">:</span>
            <span class="n">signode</span> <span class="o">+=</span> <span class="n">addnodes</span><span class="o">.</span><span class="n">desc_annotation</span><span class="p">(</span><span class="n">sig_prefix</span><span class="p">,</span> <span class="n">sig_prefix</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">prefix</span><span class="p">:</span>
            <span class="n">signode</span> <span class="o">+=</span> <span class="n">addnodes</span><span class="o">.</span><span class="n">desc_addname</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">prefix</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">add_module</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">add_module_names</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">modname</span> <span class="ow">and</span> <span class="n">modname</span> <span class="o">!=</span> <span class="s1">&#39;exceptions&#39;</span><span class="p">:</span>
                <span class="c1"># exceptions are a special case, since they are documented in the</span>
                <span class="c1"># &#39;exceptions&#39; module.</span>
                <span class="n">nodetext</span> <span class="o">=</span> <span class="n">modname</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span>
                <span class="n">signode</span> <span class="o">+=</span> <span class="n">addnodes</span><span class="o">.</span><span class="n">desc_addname</span><span class="p">(</span><span class="n">nodetext</span><span class="p">,</span> <span class="n">nodetext</span><span class="p">)</span>

        <span class="n">signode</span> <span class="o">+=</span> <span class="n">addnodes</span><span class="o">.</span><span class="n">desc_name</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">arglist</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">signode</span> <span class="o">+=</span> <span class="n">_parse_arglist</span><span class="p">(</span><span class="n">arglist</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">SyntaxError</span><span class="p">:</span>
                <span class="c1"># fallback to parse arglist original parser.</span>
                <span class="c1"># it supports to represent optional arguments (ex. &quot;func(foo [, bar])&quot;)</span>
                <span class="n">_pseudo_parse_arglist</span><span class="p">(</span><span class="n">signode</span><span class="p">,</span> <span class="n">arglist</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">NotImplementedError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;could not parse arglist (</span><span class="si">%r</span><span class="s2">): </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">arglist</span><span class="p">,</span> <span class="n">exc</span><span class="p">,</span>
                               <span class="n">location</span><span class="o">=</span><span class="n">signode</span><span class="p">)</span>
                <span class="n">_pseudo_parse_arglist</span><span class="p">(</span><span class="n">signode</span><span class="p">,</span> <span class="n">arglist</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">needs_arglist</span><span class="p">():</span>
                <span class="c1"># for callables, add an empty parameter list</span>
                <span class="n">signode</span> <span class="o">+=</span> <span class="n">addnodes</span><span class="o">.</span><span class="n">desc_parameterlist</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">retann</span><span class="p">:</span>
            <span class="n">children</span> <span class="o">=</span> <span class="n">_parse_annotation</span><span class="p">(</span><span class="n">retann</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">)</span>
            <span class="n">signode</span> <span class="o">+=</span> <span class="n">addnodes</span><span class="o">.</span><span class="n">desc_returns</span><span class="p">(</span><span class="n">retann</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">children</span><span class="p">)</span>

        <span class="n">anno</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;annotation&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">anno</span><span class="p">:</span>
            <span class="n">signode</span> <span class="o">+=</span> <span class="n">addnodes</span><span class="o">.</span><span class="n">desc_annotation</span><span class="p">(</span><span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">anno</span><span class="p">,</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">anno</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fullname</span><span class="p">,</span> <span class="n">prefix</span>

    <span class="k">def</span> <span class="nf">get_index_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the text for the index entry of the object.&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;must be implemented in subclasses&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_target_and_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name_cls</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">sig</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                             <span class="n">signode</span><span class="p">:</span> <span class="n">desc_signature</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">modname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;module&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">ref_context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;py:module&#39;</span><span class="p">))</span>
        <span class="n">fullname</span> <span class="o">=</span> <span class="p">(</span><span class="n">modname</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="k">if</span> <span class="n">modname</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">name_cls</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">node_id</span> <span class="o">=</span> <span class="n">make_id</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">document</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">fullname</span><span class="p">)</span>
        <span class="n">signode</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node_id</span><span class="p">)</span>

        <span class="c1"># Assign old styled node_id(fullname) not to break old hyperlinks (if possible)</span>
        <span class="c1"># Note: Will removed in Sphinx-5.0  (RemovedInSphinx50Warning)</span>
        <span class="k">if</span> <span class="n">node_id</span> <span class="o">!=</span> <span class="n">fullname</span> <span class="ow">and</span> <span class="n">fullname</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">ids</span><span class="p">:</span>
            <span class="n">signode</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fullname</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">note_explicit_target</span><span class="p">(</span><span class="n">signode</span><span class="p">)</span>

        <span class="n">domain</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">PythonDomain</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">get_domain</span><span class="p">(</span><span class="s1">&#39;py&#39;</span><span class="p">))</span>
        <span class="n">domain</span><span class="o">.</span><span class="n">note_object</span><span class="p">(</span><span class="n">fullname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">objtype</span><span class="p">,</span> <span class="n">node_id</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="n">signode</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;noindexentry&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
            <span class="n">indextext</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_index_text</span><span class="p">(</span><span class="n">modname</span><span class="p">,</span> <span class="n">name_cls</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">indextext</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">indexnode</span><span class="p">[</span><span class="s1">&#39;entries&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;single&#39;</span><span class="p">,</span> <span class="n">indextext</span><span class="p">,</span> <span class="n">node_id</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">before_content</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle object nesting before content</span>

<span class="sd">        :py:class:`PyObject` represents Python language constructs. For</span>
<span class="sd">        constructs that are nestable, such as a Python classes, this method will</span>
<span class="sd">        build up a stack of the nesting hierarchy so that it can be later</span>
<span class="sd">        de-nested correctly, in :py:meth:`after_content`.</span>

<span class="sd">        For constructs that aren&#39;t nestable, the stack is bypassed, and instead</span>
<span class="sd">        only the most recent object is tracked. This object prefix name will be</span>
<span class="sd">        removed with :py:meth:`after_content`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
            <span class="c1"># fullname and name_prefix come from the `handle_signature` method.</span>
            <span class="c1"># fullname represents the full object name that is constructed using</span>
            <span class="c1"># object nesting and explicit prefixes. `name_prefix` is the</span>
            <span class="c1"># explicit prefix given in a signature</span>
            <span class="p">(</span><span class="n">fullname</span><span class="p">,</span> <span class="n">name_prefix</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">allow_nesting</span><span class="p">:</span>
                <span class="n">prefix</span> <span class="o">=</span> <span class="n">fullname</span>
            <span class="k">elif</span> <span class="n">name_prefix</span><span class="p">:</span>
                <span class="n">prefix</span> <span class="o">=</span> <span class="n">name_prefix</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">prefix</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">ref_context</span><span class="p">[</span><span class="s1">&#39;py:class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prefix</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">allow_nesting</span><span class="p">:</span>
                <span class="n">classes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">ref_context</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;py:classes&#39;</span><span class="p">,</span> <span class="p">[])</span>
                <span class="n">classes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;module&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
            <span class="n">modules</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">ref_context</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;py:modules&#39;</span><span class="p">,</span> <span class="p">[])</span>
            <span class="n">modules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">ref_context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;py:module&#39;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">ref_context</span><span class="p">[</span><span class="s1">&#39;py:module&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;module&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">after_content</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle object de-nesting after content</span>

<span class="sd">        If this class is a nestable object, removing the last nested class prefix</span>
<span class="sd">        ends further nesting in the object.</span>

<span class="sd">        If this class is not a nestable object, the list of classes should not</span>
<span class="sd">        be altered as we didn&#39;t affect the nesting levels in</span>
<span class="sd">        :py:meth:`before_content`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">classes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">ref_context</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;py:classes&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">allow_nesting</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">classes</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">ref_context</span><span class="p">[</span><span class="s1">&#39;py:class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">classes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">classes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
                                            <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;module&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
            <span class="n">modules</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">ref_context</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;py:modules&#39;</span><span class="p">,</span> <span class="p">[])</span>
            <span class="k">if</span> <span class="n">modules</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">ref_context</span><span class="p">[</span><span class="s1">&#39;py:module&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">modules</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">ref_context</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;py:module&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">PyModulelevel</span><span class="p">(</span><span class="n">PyObject</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Description of an object on module level (functions, data).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Node</span><span class="p">]:</span>
        <span class="k">for</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__mro__</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">!=</span> <span class="s1">&#39;DirectiveAdapter&#39;</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;PyModulelevel is deprecated. &#39;</span>
                              <span class="s1">&#39;Please check the implementation of </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">cls</span><span class="p">,</span>
                              <span class="n">RemovedInSphinx40Warning</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;PyModulelevel is deprecated&#39;</span><span class="p">,</span>
                          <span class="n">RemovedInSphinx40Warning</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">needs_arglist</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">objtype</span> <span class="o">==</span> <span class="s1">&#39;function&#39;</span>

    <span class="k">def</span> <span class="nf">get_index_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">name_cls</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">objtype</span> <span class="o">==</span> <span class="s1">&#39;function&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">modname</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">() (built-in function)&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="n">name_cls</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">() (in module </span><span class="si">%s</span><span class="s1">)&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">name_cls</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">modname</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">objtype</span> <span class="o">==</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">modname</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> (built-in variable)&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="n">name_cls</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> (in module </span><span class="si">%s</span><span class="s1">)&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">name_cls</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">modname</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;&#39;</span>


<span class="k">class</span> <span class="nc">PyFunction</span><span class="p">(</span><span class="n">PyObject</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Description of a function.&quot;&quot;&quot;</span>

    <span class="n">option_spec</span> <span class="o">=</span> <span class="n">PyObject</span><span class="o">.</span><span class="n">option_spec</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">option_spec</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
        <span class="s1">&#39;async&#39;</span><span class="p">:</span> <span class="n">directives</span><span class="o">.</span><span class="n">flag</span><span class="p">,</span>
    <span class="p">})</span>

    <span class="k">def</span> <span class="nf">get_signature_prefix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sig</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;async&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;async &#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">needs_arglist</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">add_target_and_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name_cls</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">sig</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                             <span class="n">signode</span><span class="p">:</span> <span class="n">desc_signature</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">add_target_and_index</span><span class="p">(</span><span class="n">name_cls</span><span class="p">,</span> <span class="n">sig</span><span class="p">,</span> <span class="n">signode</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;noindexentry&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
            <span class="n">modname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;module&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">ref_context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;py:module&#39;</span><span class="p">))</span>
            <span class="n">node_id</span> <span class="o">=</span> <span class="n">signode</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">name</span><span class="p">,</span> <span class="bp">cls</span> <span class="o">=</span> <span class="n">name_cls</span>
            <span class="k">if</span> <span class="n">modname</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">() (in module </span><span class="si">%s</span><span class="s1">)&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">modname</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">indexnode</span><span class="p">[</span><span class="s1">&#39;entries&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;single&#39;</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">node_id</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">; </span><span class="si">%s</span><span class="s1">()&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">pairindextypes</span><span class="p">[</span><span class="s1">&#39;builtin&#39;</span><span class="p">],</span> <span class="n">name</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">indexnode</span><span class="p">[</span><span class="s1">&#39;entries&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;pair&#39;</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">node_id</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">get_index_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">name_cls</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="c1"># add index in own add_target_and_index() instead.</span>
        <span class="k">return</span> <span class="kc">None</span>


<span class="k">class</span> <span class="nc">PyDecoratorFunction</span><span class="p">(</span><span class="n">PyFunction</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Description of a decorator.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Node</span><span class="p">]:</span>
        <span class="c1"># a decorator function is a function after all</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;py:function&#39;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">handle_signature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sig</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">signode</span><span class="p">:</span> <span class="n">desc_signature</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">handle_signature</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span> <span class="n">signode</span><span class="p">)</span>
        <span class="n">signode</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">addnodes</span><span class="o">.</span><span class="n">desc_addname</span><span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">,</span> <span class="s1">&#39;@&#39;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">ret</span>

    <span class="k">def</span> <span class="nf">needs_arglist</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>


<span class="k">class</span> <span class="nc">PyVariable</span><span class="p">(</span><span class="n">PyObject</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Description of a variable.&quot;&quot;&quot;</span>

    <span class="n">option_spec</span> <span class="o">=</span> <span class="n">PyObject</span><span class="o">.</span><span class="n">option_spec</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">option_spec</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
        <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">directives</span><span class="o">.</span><span class="n">unchanged</span><span class="p">,</span>
        <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">directives</span><span class="o">.</span><span class="n">unchanged</span><span class="p">,</span>
    <span class="p">})</span>

    <span class="k">def</span> <span class="nf">handle_signature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sig</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">signode</span><span class="p">:</span> <span class="n">desc_signature</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
        <span class="n">fullname</span><span class="p">,</span> <span class="n">prefix</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">handle_signature</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span> <span class="n">signode</span><span class="p">)</span>

        <span class="n">typ</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">typ</span><span class="p">:</span>
            <span class="n">annotations</span> <span class="o">=</span> <span class="n">_parse_annotation</span><span class="p">(</span><span class="n">typ</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">)</span>
            <span class="n">signode</span> <span class="o">+=</span> <span class="n">addnodes</span><span class="o">.</span><span class="n">desc_annotation</span><span class="p">(</span><span class="n">typ</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;: &#39;</span><span class="p">),</span> <span class="o">*</span><span class="n">annotations</span><span class="p">)</span>

        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span><span class="p">:</span>
            <span class="n">signode</span> <span class="o">+=</span> <span class="n">addnodes</span><span class="o">.</span><span class="n">desc_annotation</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39; = &#39;</span> <span class="o">+</span> <span class="n">value</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fullname</span><span class="p">,</span> <span class="n">prefix</span>

    <span class="k">def</span> <span class="nf">get_index_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">name_cls</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">name</span><span class="p">,</span> <span class="bp">cls</span> <span class="o">=</span> <span class="n">name_cls</span>
        <span class="k">if</span> <span class="n">modname</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> (in module </span><span class="si">%s</span><span class="s1">)&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">modname</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> (built-in variable)&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="n">name</span>


<span class="k">class</span> <span class="nc">PyClasslike</span><span class="p">(</span><span class="n">PyObject</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Description of a class-like object (classes, interfaces, exceptions).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">option_spec</span> <span class="o">=</span> <span class="n">PyObject</span><span class="o">.</span><span class="n">option_spec</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">option_spec</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
        <span class="s1">&#39;final&#39;</span><span class="p">:</span> <span class="n">directives</span><span class="o">.</span><span class="n">flag</span><span class="p">,</span>
    <span class="p">})</span>

    <span class="n">allow_nesting</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">get_signature_prefix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sig</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;final&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;final </span><span class="si">%s</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">objtype</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">objtype</span>

    <span class="k">def</span> <span class="nf">get_index_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">name_cls</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">objtype</span> <span class="o">==</span> <span class="s1">&#39;class&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">modname</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> (built-in class)&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="n">name_cls</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> (class in </span><span class="si">%s</span><span class="s1">)&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">name_cls</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">modname</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">objtype</span> <span class="o">==</span> <span class="s1">&#39;exception&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">name_cls</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;&#39;</span>


<span class="k">class</span> <span class="nc">PyClassmember</span><span class="p">(</span><span class="n">PyObject</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Description of a class member (methods, attributes).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Node</span><span class="p">]:</span>
        <span class="k">for</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__mro__</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">!=</span> <span class="s1">&#39;DirectiveAdapter&#39;</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;PyClassmember is deprecated. &#39;</span>
                              <span class="s1">&#39;Please check the implementation of </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">cls</span><span class="p">,</span>
                              <span class="n">RemovedInSphinx40Warning</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;PyClassmember is deprecated&#39;</span><span class="p">,</span>
                          <span class="n">RemovedInSphinx40Warning</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">needs_arglist</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">objtype</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;method&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_signature_prefix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sig</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">objtype</span> <span class="o">==</span> <span class="s1">&#39;staticmethod&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;static &#39;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">objtype</span> <span class="o">==</span> <span class="s1">&#39;classmethod&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;classmethod &#39;</span>
        <span class="k">return</span> <span class="s1">&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">get_index_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">name_cls</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">name</span><span class="p">,</span> <span class="bp">cls</span> <span class="o">=</span> <span class="n">name_cls</span>
        <span class="n">add_modules</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">add_module_names</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">objtype</span> <span class="o">==</span> <span class="s1">&#39;method&#39;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">clsname</span><span class="p">,</span> <span class="n">methname</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">modname</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">() (in module </span><span class="si">%s</span><span class="s1">)&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">modname</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">()&#39;</span> <span class="o">%</span> <span class="n">name</span>
            <span class="k">if</span> <span class="n">modname</span> <span class="ow">and</span> <span class="n">add_modules</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">() (</span><span class="si">%s</span><span class="s1">.</span><span class="si">%s</span><span class="s1"> method)&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">methname</span><span class="p">,</span> <span class="n">modname</span><span class="p">,</span> <span class="n">clsname</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">() (</span><span class="si">%s</span><span class="s1"> method)&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">methname</span><span class="p">,</span> <span class="n">clsname</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">objtype</span> <span class="o">==</span> <span class="s1">&#39;staticmethod&#39;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">clsname</span><span class="p">,</span> <span class="n">methname</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">modname</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">() (in module </span><span class="si">%s</span><span class="s1">)&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">modname</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">()&#39;</span> <span class="o">%</span> <span class="n">name</span>
            <span class="k">if</span> <span class="n">modname</span> <span class="ow">and</span> <span class="n">add_modules</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">() (</span><span class="si">%s</span><span class="s1">.</span><span class="si">%s</span><span class="s1"> static method)&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">methname</span><span class="p">,</span> <span class="n">modname</span><span class="p">,</span>
                                                          <span class="n">clsname</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">() (</span><span class="si">%s</span><span class="s1"> static method)&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">methname</span><span class="p">,</span> <span class="n">clsname</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">objtype</span> <span class="o">==</span> <span class="s1">&#39;classmethod&#39;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">clsname</span><span class="p">,</span> <span class="n">methname</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">modname</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">() (in module </span><span class="si">%s</span><span class="s1">)&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">modname</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">()&#39;</span> <span class="o">%</span> <span class="n">name</span>
            <span class="k">if</span> <span class="n">modname</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">() (</span><span class="si">%s</span><span class="s1">.</span><span class="si">%s</span><span class="s1"> class method)&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">methname</span><span class="p">,</span> <span class="n">modname</span><span class="p">,</span>
                                                         <span class="n">clsname</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">() (</span><span class="si">%s</span><span class="s1"> class method)&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">methname</span><span class="p">,</span> <span class="n">clsname</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">objtype</span> <span class="o">==</span> <span class="s1">&#39;attribute&#39;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">clsname</span><span class="p">,</span> <span class="n">attrname</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">modname</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> (in module </span><span class="si">%s</span><span class="s1">)&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">modname</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">name</span>
            <span class="k">if</span> <span class="n">modname</span> <span class="ow">and</span> <span class="n">add_modules</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> (</span><span class="si">%s</span><span class="s1">.</span><span class="si">%s</span><span class="s1"> attribute)&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">attrname</span><span class="p">,</span> <span class="n">modname</span><span class="p">,</span> <span class="n">clsname</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> (</span><span class="si">%s</span><span class="s1"> attribute)&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">attrname</span><span class="p">,</span> <span class="n">clsname</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;&#39;</span>


<span class="k">class</span> <span class="nc">PyMethod</span><span class="p">(</span><span class="n">PyObject</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Description of a method.&quot;&quot;&quot;</span>

    <span class="n">option_spec</span> <span class="o">=</span> <span class="n">PyObject</span><span class="o">.</span><span class="n">option_spec</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">option_spec</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
        <span class="s1">&#39;abstractmethod&#39;</span><span class="p">:</span> <span class="n">directives</span><span class="o">.</span><span class="n">flag</span><span class="p">,</span>
        <span class="s1">&#39;async&#39;</span><span class="p">:</span> <span class="n">directives</span><span class="o">.</span><span class="n">flag</span><span class="p">,</span>
        <span class="s1">&#39;classmethod&#39;</span><span class="p">:</span> <span class="n">directives</span><span class="o">.</span><span class="n">flag</span><span class="p">,</span>
        <span class="s1">&#39;final&#39;</span><span class="p">:</span> <span class="n">directives</span><span class="o">.</span><span class="n">flag</span><span class="p">,</span>
        <span class="s1">&#39;property&#39;</span><span class="p">:</span> <span class="n">directives</span><span class="o">.</span><span class="n">flag</span><span class="p">,</span>
        <span class="s1">&#39;staticmethod&#39;</span><span class="p">:</span> <span class="n">directives</span><span class="o">.</span><span class="n">flag</span><span class="p">,</span>
    <span class="p">})</span>

    <span class="k">def</span> <span class="nf">needs_arglist</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;property&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">get_signature_prefix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sig</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="s1">&#39;final&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
            <span class="n">prefix</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;final&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;abstractmethod&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
            <span class="n">prefix</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;abstract&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;async&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
            <span class="n">prefix</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;async&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;classmethod&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
            <span class="n">prefix</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;classmethod&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;property&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
            <span class="n">prefix</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;property&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;staticmethod&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
            <span class="n">prefix</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;static&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">prefix</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">get_index_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">name_cls</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">name</span><span class="p">,</span> <span class="bp">cls</span> <span class="o">=</span> <span class="n">name_cls</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">clsname</span><span class="p">,</span> <span class="n">methname</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">modname</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">add_module_names</span><span class="p">:</span>
                <span class="n">clsname</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">modname</span><span class="p">,</span> <span class="n">clsname</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">modname</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">() (in module </span><span class="si">%s</span><span class="s1">)&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">modname</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">()&#39;</span> <span class="o">%</span> <span class="n">name</span>

        <span class="k">if</span> <span class="s1">&#39;classmethod&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">() (</span><span class="si">%s</span><span class="s1"> class method)&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">methname</span><span class="p">,</span> <span class="n">clsname</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s1">&#39;property&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">() (</span><span class="si">%s</span><span class="s1"> property)&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">methname</span><span class="p">,</span> <span class="n">clsname</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s1">&#39;staticmethod&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">() (</span><span class="si">%s</span><span class="s1"> static method)&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">methname</span><span class="p">,</span> <span class="n">clsname</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">() (</span><span class="si">%s</span><span class="s1"> method)&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">methname</span><span class="p">,</span> <span class="n">clsname</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">PyClassMethod</span><span class="p">(</span><span class="n">PyMethod</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Description of a classmethod.&quot;&quot;&quot;</span>

    <span class="n">option_spec</span> <span class="o">=</span> <span class="n">PyObject</span><span class="o">.</span><span class="n">option_spec</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Node</span><span class="p">]:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;py:method&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;classmethod&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">PyStaticMethod</span><span class="p">(</span><span class="n">PyMethod</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Description of a staticmethod.&quot;&quot;&quot;</span>

    <span class="n">option_spec</span> <span class="o">=</span> <span class="n">PyObject</span><span class="o">.</span><span class="n">option_spec</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Node</span><span class="p">]:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;py:method&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;staticmethod&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">PyDecoratorMethod</span><span class="p">(</span><span class="n">PyMethod</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Description of a decoratormethod.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Node</span><span class="p">]:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;py:method&#39;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">handle_signature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sig</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">signode</span><span class="p">:</span> <span class="n">desc_signature</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">handle_signature</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span> <span class="n">signode</span><span class="p">)</span>
        <span class="n">signode</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">addnodes</span><span class="o">.</span><span class="n">desc_addname</span><span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">,</span> <span class="s1">&#39;@&#39;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">ret</span>

    <span class="k">def</span> <span class="nf">needs_arglist</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>


<span class="k">class</span> <span class="nc">PyAttribute</span><span class="p">(</span><span class="n">PyObject</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Description of an attribute.&quot;&quot;&quot;</span>

    <span class="n">option_spec</span> <span class="o">=</span> <span class="n">PyObject</span><span class="o">.</span><span class="n">option_spec</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">option_spec</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
        <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">directives</span><span class="o">.</span><span class="n">unchanged</span><span class="p">,</span>
        <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">directives</span><span class="o">.</span><span class="n">unchanged</span><span class="p">,</span>
    <span class="p">})</span>

    <span class="k">def</span> <span class="nf">handle_signature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sig</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">signode</span><span class="p">:</span> <span class="n">desc_signature</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
        <span class="n">fullname</span><span class="p">,</span> <span class="n">prefix</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">handle_signature</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span> <span class="n">signode</span><span class="p">)</span>

        <span class="n">typ</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">typ</span><span class="p">:</span>
            <span class="n">annotations</span> <span class="o">=</span> <span class="n">_parse_annotation</span><span class="p">(</span><span class="n">typ</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">)</span>
            <span class="n">signode</span> <span class="o">+=</span> <span class="n">addnodes</span><span class="o">.</span><span class="n">desc_annotation</span><span class="p">(</span><span class="n">typ</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">nodes</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;: &#39;</span><span class="p">),</span> <span class="o">*</span><span class="n">annotations</span><span class="p">)</span>

        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span><span class="p">:</span>
            <span class="n">signode</span> <span class="o">+=</span> <span class="n">addnodes</span><span class="o">.</span><span class="n">desc_annotation</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39; = &#39;</span> <span class="o">+</span> <span class="n">value</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fullname</span><span class="p">,</span> <span class="n">prefix</span>

    <span class="k">def</span> <span class="nf">get_index_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">name_cls</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">name</span><span class="p">,</span> <span class="bp">cls</span> <span class="o">=</span> <span class="n">name_cls</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">clsname</span><span class="p">,</span> <span class="n">attrname</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">modname</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">add_module_names</span><span class="p">:</span>
                <span class="n">clsname</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">modname</span><span class="p">,</span> <span class="n">clsname</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">modname</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> (in module </span><span class="si">%s</span><span class="s1">)&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">modname</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">name</span>

        <span class="k">return</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> (</span><span class="si">%s</span><span class="s1"> attribute)&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">attrname</span><span class="p">,</span> <span class="n">clsname</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">PyDecoratorMixin</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Mixin for decorator directives.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">handle_signature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sig</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">signode</span><span class="p">:</span> <span class="n">desc_signature</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
        <span class="k">for</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__mro__</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">!=</span> <span class="s1">&#39;DirectiveAdapter&#39;</span><span class="p">:</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;PyDecoratorMixin is deprecated. &#39;</span>
                              <span class="s1">&#39;Please check the implementation of </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">cls</span><span class="p">,</span>
                              <span class="n">RemovedInSphinx50Warning</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;PyDecoratorMixin is deprecated&#39;</span><span class="p">,</span>
                          <span class="n">RemovedInSphinx50Warning</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">ret</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">handle_signature</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span> <span class="n">signode</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
        <span class="n">signode</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">addnodes</span><span class="o">.</span><span class="n">desc_addname</span><span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">,</span> <span class="s1">&#39;@&#39;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">ret</span>

    <span class="k">def</span> <span class="nf">needs_arglist</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>


<span class="k">class</span> <span class="nc">PyModule</span><span class="p">(</span><span class="n">SphinxDirective</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Directive to mark description of a new module.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">has_content</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">required_arguments</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">optional_arguments</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">final_argument_whitespace</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">option_spec</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;platform&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span>
        <span class="s1">&#39;synopsis&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span>
        <span class="s1">&#39;noindex&#39;</span><span class="p">:</span> <span class="n">directives</span><span class="o">.</span><span class="n">flag</span><span class="p">,</span>
        <span class="s1">&#39;deprecated&#39;</span><span class="p">:</span> <span class="n">directives</span><span class="o">.</span><span class="n">flag</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Node</span><span class="p">]:</span>
        <span class="n">domain</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">PythonDomain</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">get_domain</span><span class="p">(</span><span class="s1">&#39;py&#39;</span><span class="p">))</span>

        <span class="n">modname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">noindex</span> <span class="o">=</span> <span class="s1">&#39;noindex&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">ref_context</span><span class="p">[</span><span class="s1">&#39;py:module&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">modname</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># type: List[Node]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">noindex</span><span class="p">:</span>
            <span class="c1"># note module to the domain</span>
            <span class="n">node_id</span> <span class="o">=</span> <span class="n">make_id</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">document</span><span class="p">,</span> <span class="s1">&#39;module&#39;</span><span class="p">,</span> <span class="n">modname</span><span class="p">)</span>
            <span class="n">target</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">target</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">ids</span><span class="o">=</span><span class="p">[</span><span class="n">node_id</span><span class="p">],</span> <span class="n">ismod</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_source_info</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>

            <span class="c1"># Assign old styled node_id not to break old hyperlinks (if possible)</span>
            <span class="c1"># Note: Will removed in Sphinx-5.0  (RemovedInSphinx50Warning)</span>
            <span class="n">old_node_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_old_id</span><span class="p">(</span><span class="n">modname</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">node_id</span> <span class="o">!=</span> <span class="n">old_node_id</span> <span class="ow">and</span> <span class="n">old_node_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">ids</span><span class="p">:</span>
                <span class="n">target</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">old_node_id</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">note_explicit_target</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>

            <span class="n">domain</span><span class="o">.</span><span class="n">note_module</span><span class="p">(</span><span class="n">modname</span><span class="p">,</span>
                               <span class="n">node_id</span><span class="p">,</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;synopsis&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;platform&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
                               <span class="s1">&#39;deprecated&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
            <span class="n">domain</span><span class="o">.</span><span class="n">note_object</span><span class="p">(</span><span class="n">modname</span><span class="p">,</span> <span class="s1">&#39;module&#39;</span><span class="p">,</span> <span class="n">node_id</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="n">target</span><span class="p">)</span>

            <span class="c1"># the platform and synopsis aren&#39;t printed; in fact, they are only</span>
            <span class="c1"># used in the modindex currently</span>
            <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
            <span class="n">indextext</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">; </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">pairindextypes</span><span class="p">[</span><span class="s1">&#39;module&#39;</span><span class="p">],</span> <span class="n">modname</span><span class="p">)</span>
            <span class="n">inode</span> <span class="o">=</span> <span class="n">addnodes</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">entries</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;pair&#39;</span><span class="p">,</span> <span class="n">indextext</span><span class="p">,</span> <span class="n">node_id</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)])</span>
            <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inode</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span>

    <span class="k">def</span> <span class="nf">make_old_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate old styled node_id.</span>

<span class="sd">        Old styled node_id is incompatible with docutils&#39; node_id.</span>
<span class="sd">        It can contain dots and hyphens.</span>

<span class="sd">        .. note:: Old styled node_id was mainly used until Sphinx-3.0.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s1">&#39;module-</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">name</span>


<span class="k">class</span> <span class="nc">PyCurrentModule</span><span class="p">(</span><span class="n">SphinxDirective</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This directive is just to tell Sphinx that we&#39;re documenting</span>
<span class="sd">    stuff in module foo, but links to module foo won&#39;t lead here.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">has_content</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">required_arguments</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">optional_arguments</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">final_argument_whitespace</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">option_spec</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># type: Dict</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Node</span><span class="p">]:</span>
        <span class="n">modname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">modname</span> <span class="o">==</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">ref_context</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;py:module&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">ref_context</span><span class="p">[</span><span class="s1">&#39;py:module&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">modname</span>
        <span class="k">return</span> <span class="p">[]</span>


<span class="k">class</span> <span class="nc">PyXRefRole</span><span class="p">(</span><span class="n">XRefRole</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">process_link</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">env</span><span class="p">:</span> <span class="n">BuildEnvironment</span><span class="p">,</span> <span class="n">refnode</span><span class="p">:</span> <span class="n">Element</span><span class="p">,</span>
                     <span class="n">has_explicit_title</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">title</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
        <span class="n">refnode</span><span class="p">[</span><span class="s1">&#39;py:module&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">ref_context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;py:module&#39;</span><span class="p">)</span>
        <span class="n">refnode</span><span class="p">[</span><span class="s1">&#39;py:class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">ref_context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;py:class&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">has_explicit_title</span><span class="p">:</span>
            <span class="n">title</span> <span class="o">=</span> <span class="n">title</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>    <span class="c1"># only has a meaning for the target</span>
            <span class="n">target</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;~&#39;</span><span class="p">)</span>  <span class="c1"># only has a meaning for the title</span>
            <span class="c1"># if the first character is a tilde, don&#39;t display the module/class</span>
            <span class="c1"># parts of the contents</span>
            <span class="k">if</span> <span class="n">title</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;~&#39;</span><span class="p">:</span>
                <span class="n">title</span> <span class="o">=</span> <span class="n">title</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
                <span class="n">dot</span> <span class="o">=</span> <span class="n">title</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">dot</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">title</span> <span class="o">=</span> <span class="n">title</span><span class="p">[</span><span class="n">dot</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]</span>
        <span class="c1"># if the first character is a dot, search more specific namespaces first</span>
        <span class="c1"># else search builtins first</span>
        <span class="k">if</span> <span class="n">target</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;.&#39;</span><span class="p">:</span>
            <span class="n">target</span> <span class="o">=</span> <span class="n">target</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="n">refnode</span><span class="p">[</span><span class="s1">&#39;refspecific&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="n">title</span><span class="p">,</span> <span class="n">target</span>


<span class="k">def</span> <span class="nf">filter_meta_fields</span><span class="p">(</span><span class="n">app</span><span class="p">:</span> <span class="n">Sphinx</span><span class="p">,</span> <span class="n">domain</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">objtype</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="n">Element</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Filter ``:meta:`` field from its docstring.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">domain</span> <span class="o">!=</span> <span class="s1">&#39;py&#39;</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">content</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">nodes</span><span class="o">.</span><span class="n">field_list</span><span class="p">):</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">List</span><span class="p">[</span><span class="n">nodes</span><span class="o">.</span><span class="n">field</span><span class="p">],</span> <span class="n">node</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
                <span class="n">field_name</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">nodes</span><span class="o">.</span><span class="n">field_body</span><span class="p">,</span> <span class="n">field</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">astext</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">field_name</span> <span class="o">==</span> <span class="s1">&#39;meta&#39;</span> <span class="ow">or</span> <span class="n">field_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;meta &#39;</span><span class="p">):</span>
                    <span class="n">node</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
                    <span class="k">break</span>


<span class="k">class</span> <span class="nc">PythonModuleIndex</span><span class="p">(</span><span class="n">Index</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Index subclass to provide the Python module index.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;modindex&#39;</span>
    <span class="n">localname</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Python Module Index&#39;</span><span class="p">)</span>
    <span class="n">shortname</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;modules&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">generate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">docnames</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
                 <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">IndexEntry</span><span class="p">]]],</span> <span class="nb">bool</span><span class="p">]:</span>
        <span class="n">content</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># type: Dict[str, List[IndexEntry]]</span>
        <span class="c1"># list of prefixes to ignore</span>
        <span class="n">ignores</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: List[str]</span>
        <span class="n">ignores</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;modindex_common_prefix&#39;</span><span class="p">]</span>  <span class="c1"># type: ignore</span>
        <span class="n">ignores</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">ignores</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="nb">len</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># list of all modules, sorted by module name</span>
        <span class="n">modules</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;modules&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span>
                         <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
        <span class="c1"># sort out collapsable modules</span>
        <span class="n">prev_modname</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">num_toplevels</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">modname</span><span class="p">,</span> <span class="p">(</span><span class="n">docname</span><span class="p">,</span> <span class="n">node_id</span><span class="p">,</span> <span class="n">synopsis</span><span class="p">,</span> <span class="n">platforms</span><span class="p">,</span> <span class="n">deprecated</span><span class="p">)</span> <span class="ow">in</span> <span class="n">modules</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">docnames</span> <span class="ow">and</span> <span class="n">docname</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">docnames</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="k">for</span> <span class="n">ignore</span> <span class="ow">in</span> <span class="n">ignores</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">modname</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">ignore</span><span class="p">):</span>
                    <span class="n">modname</span> <span class="o">=</span> <span class="n">modname</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">ignore</span><span class="p">):]</span>
                    <span class="n">stripped</span> <span class="o">=</span> <span class="n">ignore</span>
                    <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">stripped</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

            <span class="c1"># we stripped the whole module name?</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">modname</span><span class="p">:</span>
                <span class="n">modname</span><span class="p">,</span> <span class="n">stripped</span> <span class="o">=</span> <span class="n">stripped</span><span class="p">,</span> <span class="s1">&#39;&#39;</span>

            <span class="n">entries</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">modname</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="p">[])</span>

            <span class="n">package</span> <span class="o">=</span> <span class="n">modname</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">package</span> <span class="o">!=</span> <span class="n">modname</span><span class="p">:</span>
                <span class="c1"># it&#39;s a submodule</span>
                <span class="k">if</span> <span class="n">prev_modname</span> <span class="o">==</span> <span class="n">package</span><span class="p">:</span>
                    <span class="c1"># first submodule - make parent a group head</span>
                    <span class="k">if</span> <span class="n">entries</span><span class="p">:</span>
                        <span class="n">last</span> <span class="o">=</span> <span class="n">entries</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                        <span class="n">entries</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">IndexEntry</span><span class="p">(</span><span class="n">last</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="n">last</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">last</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
                                                 <span class="n">last</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">last</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">last</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
                <span class="k">elif</span> <span class="ow">not</span> <span class="n">prev_modname</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">package</span><span class="p">):</span>
                    <span class="c1"># submodule without parent in list, add dummy entry</span>
                    <span class="n">entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">IndexEntry</span><span class="p">(</span><span class="n">stripped</span> <span class="o">+</span> <span class="n">package</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
                <span class="n">subtype</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">num_toplevels</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">subtype</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="n">qualifier</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Deprecated&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">deprecated</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
            <span class="n">entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">IndexEntry</span><span class="p">(</span><span class="n">stripped</span> <span class="o">+</span> <span class="n">modname</span><span class="p">,</span> <span class="n">subtype</span><span class="p">,</span> <span class="n">docname</span><span class="p">,</span>
                                      <span class="n">node_id</span><span class="p">,</span> <span class="n">platforms</span><span class="p">,</span> <span class="n">qualifier</span><span class="p">,</span> <span class="n">synopsis</span><span class="p">))</span>
            <span class="n">prev_modname</span> <span class="o">=</span> <span class="n">modname</span>

        <span class="c1"># apply heuristics when to collapse modindex at page load:</span>
        <span class="c1"># only collapse if number of toplevel modules is larger than</span>
        <span class="c1"># number of submodules</span>
        <span class="n">collapse</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">modules</span><span class="p">)</span> <span class="o">-</span> <span class="n">num_toplevels</span> <span class="o">&lt;</span> <span class="n">num_toplevels</span>

        <span class="c1"># sort by first letter</span>
        <span class="n">sorted_content</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">content</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>

        <span class="k">return</span> <span class="n">sorted_content</span><span class="p">,</span> <span class="n">collapse</span>


<div class="viewcode-block" id="PythonDomain"><a class="viewcode-back" href="../../../extdev/domainapi.html#sphinx.domains.python.PythonDomain">[docs]</a><span class="k">class</span> <span class="nc">PythonDomain</span><span class="p">(</span><span class="n">Domain</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Python language domain.&quot;&quot;&quot;</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;py&#39;</span>
    <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Python&#39;</span>
    <span class="n">object_types</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;function&#39;</span><span class="p">:</span>     <span class="n">ObjType</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;function&#39;</span><span class="p">),</span>      <span class="s1">&#39;func&#39;</span><span class="p">,</span> <span class="s1">&#39;obj&#39;</span><span class="p">),</span>
        <span class="s1">&#39;data&#39;</span><span class="p">:</span>         <span class="n">ObjType</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">),</span>          <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;obj&#39;</span><span class="p">),</span>
        <span class="s1">&#39;class&#39;</span><span class="p">:</span>        <span class="n">ObjType</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;class&#39;</span><span class="p">),</span>         <span class="s1">&#39;class&#39;</span><span class="p">,</span> <span class="s1">&#39;exc&#39;</span><span class="p">,</span> <span class="s1">&#39;obj&#39;</span><span class="p">),</span>
        <span class="s1">&#39;exception&#39;</span><span class="p">:</span>    <span class="n">ObjType</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;exception&#39;</span><span class="p">),</span>     <span class="s1">&#39;exc&#39;</span><span class="p">,</span> <span class="s1">&#39;class&#39;</span><span class="p">,</span> <span class="s1">&#39;obj&#39;</span><span class="p">),</span>
        <span class="s1">&#39;method&#39;</span><span class="p">:</span>       <span class="n">ObjType</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;method&#39;</span><span class="p">),</span>        <span class="s1">&#39;meth&#39;</span><span class="p">,</span> <span class="s1">&#39;obj&#39;</span><span class="p">),</span>
        <span class="s1">&#39;classmethod&#39;</span><span class="p">:</span>  <span class="n">ObjType</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;class method&#39;</span><span class="p">),</span>  <span class="s1">&#39;meth&#39;</span><span class="p">,</span> <span class="s1">&#39;obj&#39;</span><span class="p">),</span>
        <span class="s1">&#39;staticmethod&#39;</span><span class="p">:</span> <span class="n">ObjType</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;static method&#39;</span><span class="p">),</span> <span class="s1">&#39;meth&#39;</span><span class="p">,</span> <span class="s1">&#39;obj&#39;</span><span class="p">),</span>
        <span class="s1">&#39;attribute&#39;</span><span class="p">:</span>    <span class="n">ObjType</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;attribute&#39;</span><span class="p">),</span>     <span class="s1">&#39;attr&#39;</span><span class="p">,</span> <span class="s1">&#39;obj&#39;</span><span class="p">),</span>
        <span class="s1">&#39;module&#39;</span><span class="p">:</span>       <span class="n">ObjType</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;module&#39;</span><span class="p">),</span>        <span class="s1">&#39;mod&#39;</span><span class="p">,</span> <span class="s1">&#39;obj&#39;</span><span class="p">),</span>
    <span class="p">}</span>  <span class="c1"># type: Dict[str, ObjType]</span>

    <span class="n">directives</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;function&#39;</span><span class="p">:</span>        <span class="n">PyFunction</span><span class="p">,</span>
        <span class="s1">&#39;data&#39;</span><span class="p">:</span>            <span class="n">PyVariable</span><span class="p">,</span>
        <span class="s1">&#39;class&#39;</span><span class="p">:</span>           <span class="n">PyClasslike</span><span class="p">,</span>
        <span class="s1">&#39;exception&#39;</span><span class="p">:</span>       <span class="n">PyClasslike</span><span class="p">,</span>
        <span class="s1">&#39;method&#39;</span><span class="p">:</span>          <span class="n">PyMethod</span><span class="p">,</span>
        <span class="s1">&#39;classmethod&#39;</span><span class="p">:</span>     <span class="n">PyClassMethod</span><span class="p">,</span>
        <span class="s1">&#39;staticmethod&#39;</span><span class="p">:</span>    <span class="n">PyStaticMethod</span><span class="p">,</span>
        <span class="s1">&#39;attribute&#39;</span><span class="p">:</span>       <span class="n">PyAttribute</span><span class="p">,</span>
        <span class="s1">&#39;module&#39;</span><span class="p">:</span>          <span class="n">PyModule</span><span class="p">,</span>
        <span class="s1">&#39;currentmodule&#39;</span><span class="p">:</span>   <span class="n">PyCurrentModule</span><span class="p">,</span>
        <span class="s1">&#39;decorator&#39;</span><span class="p">:</span>       <span class="n">PyDecoratorFunction</span><span class="p">,</span>
        <span class="s1">&#39;decoratormethod&#39;</span><span class="p">:</span> <span class="n">PyDecoratorMethod</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">roles</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;data&#39;</span><span class="p">:</span>  <span class="n">PyXRefRole</span><span class="p">(),</span>
        <span class="s1">&#39;exc&#39;</span><span class="p">:</span>   <span class="n">PyXRefRole</span><span class="p">(),</span>
        <span class="s1">&#39;func&#39;</span><span class="p">:</span>  <span class="n">PyXRefRole</span><span class="p">(</span><span class="n">fix_parens</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="n">PyXRefRole</span><span class="p">(),</span>
        <span class="s1">&#39;const&#39;</span><span class="p">:</span> <span class="n">PyXRefRole</span><span class="p">(),</span>
        <span class="s1">&#39;attr&#39;</span><span class="p">:</span>  <span class="n">PyXRefRole</span><span class="p">(),</span>
        <span class="s1">&#39;meth&#39;</span><span class="p">:</span>  <span class="n">PyXRefRole</span><span class="p">(</span><span class="n">fix_parens</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="s1">&#39;mod&#39;</span><span class="p">:</span>   <span class="n">PyXRefRole</span><span class="p">(),</span>
        <span class="s1">&#39;obj&#39;</span><span class="p">:</span>   <span class="n">PyXRefRole</span><span class="p">(),</span>
    <span class="p">}</span>
    <span class="n">initial_data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;objects&#39;</span><span class="p">:</span> <span class="p">{},</span>  <span class="c1"># fullname -&gt; docname, objtype</span>
        <span class="s1">&#39;modules&#39;</span><span class="p">:</span> <span class="p">{},</span>  <span class="c1"># modname -&gt; docname, synopsis, platform, deprecated</span>
    <span class="p">}</span>  <span class="c1"># type: Dict[str, Dict[str, Tuple[Any]]]</span>
    <span class="n">indices</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">PythonModuleIndex</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">objects</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ObjectEntry</span><span class="p">]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;objects&#39;</span><span class="p">,</span> <span class="p">{})</span>  <span class="c1"># fullname -&gt; ObjectEntry</span>

<div class="viewcode-block" id="PythonDomain.note_object"><a class="viewcode-back" href="../../../extdev/domainapi.html#sphinx.domains.python.PythonDomain.note_object">[docs]</a>    <span class="k">def</span> <span class="nf">note_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">objtype</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">node_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">location</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Note a python object for cross reference.</span>

<span class="sd">        .. versionadded:: 2.1</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">:</span>
            <span class="n">other</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">__</span><span class="p">(</span><span class="s1">&#39;duplicate object description of </span><span class="si">%s</span><span class="s1">, &#39;</span>
                              <span class="s1">&#39;other instance in </span><span class="si">%s</span><span class="s1">, use :noindex: for one of them&#39;</span><span class="p">),</span>
                           <span class="n">name</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">docname</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="n">location</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">ObjectEntry</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">docname</span><span class="p">,</span> <span class="n">node_id</span><span class="p">,</span> <span class="n">objtype</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">modules</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ModuleEntry</span><span class="p">]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;modules&#39;</span><span class="p">,</span> <span class="p">{})</span>  <span class="c1"># modname -&gt; ModuleEntry</span>

<div class="viewcode-block" id="PythonDomain.note_module"><a class="viewcode-back" href="../../../extdev/domainapi.html#sphinx.domains.python.PythonDomain.note_module">[docs]</a>    <span class="k">def</span> <span class="nf">note_module</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">node_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">synopsis</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                    <span class="n">platform</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">deprecated</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Note a python module for cross reference.</span>

<span class="sd">        .. versionadded:: 2.1</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">ModuleEntry</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">docname</span><span class="p">,</span> <span class="n">node_id</span><span class="p">,</span>
                                         <span class="n">synopsis</span><span class="p">,</span> <span class="n">platform</span><span class="p">,</span> <span class="n">deprecated</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">clear_doc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">docname</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">fullname</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">docname</span> <span class="o">==</span> <span class="n">docname</span><span class="p">:</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">fullname</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">modname</span><span class="p">,</span> <span class="n">mod</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">mod</span><span class="o">.</span><span class="n">docname</span> <span class="o">==</span> <span class="n">docname</span><span class="p">:</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">modname</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">merge_domaindata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">docnames</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">otherdata</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># XXX check duplicates?</span>
        <span class="k">for</span> <span class="n">fullname</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">otherdata</span><span class="p">[</span><span class="s1">&#39;objects&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">docname</span> <span class="ow">in</span> <span class="n">docnames</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">fullname</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span>
        <span class="k">for</span> <span class="n">modname</span><span class="p">,</span> <span class="n">mod</span> <span class="ow">in</span> <span class="n">otherdata</span><span class="p">[</span><span class="s1">&#39;modules&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">mod</span><span class="o">.</span><span class="n">docname</span> <span class="ow">in</span> <span class="n">docnames</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">modname</span><span class="p">]</span> <span class="o">=</span> <span class="n">mod</span>

    <span class="k">def</span> <span class="nf">find_obj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">env</span><span class="p">:</span> <span class="n">BuildEnvironment</span><span class="p">,</span> <span class="n">modname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">classname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                 <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">searchmode</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
                 <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ObjectEntry</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Find a Python object for &quot;name&quot;, perhaps using the given module</span>
<span class="sd">        and/or classname.  Returns a list of (name, object entry) tuples.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># skip parens</span>
        <span class="k">if</span> <span class="n">name</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span> <span class="o">==</span> <span class="s1">&#39;()&#39;</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="n">matches</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># type: List[Tuple[str, ObjectEntry]]</span>

        <span class="n">newname</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">searchmode</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">objtypes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">object_types</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">objtypes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">objtypes_for_role</span><span class="p">(</span><span class="nb">type</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">objtypes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">modname</span> <span class="ow">and</span> <span class="n">classname</span><span class="p">:</span>
                    <span class="n">fullname</span> <span class="o">=</span> <span class="n">modname</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">classname</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">name</span>
                    <span class="k">if</span> <span class="n">fullname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">objects</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">fullname</span><span class="p">]</span><span class="o">.</span><span class="n">objtype</span> <span class="ow">in</span> <span class="n">objtypes</span><span class="p">:</span>
                        <span class="n">newname</span> <span class="o">=</span> <span class="n">fullname</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">newname</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">modname</span> <span class="ow">and</span> <span class="n">modname</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">objects</span> <span class="ow">and</span> \
                       <span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">modname</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">objtype</span> <span class="ow">in</span> <span class="n">objtypes</span><span class="p">:</span>
                        <span class="n">newname</span> <span class="o">=</span> <span class="n">modname</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">name</span>
                    <span class="k">elif</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">objects</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">objtype</span> <span class="ow">in</span> <span class="n">objtypes</span><span class="p">:</span>
                        <span class="n">newname</span> <span class="o">=</span> <span class="n">name</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># &quot;fuzzy&quot; searching mode</span>
                        <span class="n">searchname</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">name</span>
                        <span class="n">matches</span> <span class="o">=</span> <span class="p">[(</span><span class="n">oname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">oname</span><span class="p">])</span> <span class="k">for</span> <span class="n">oname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">objects</span>
                                   <span class="k">if</span> <span class="n">oname</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">searchname</span><span class="p">)</span> <span class="ow">and</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">oname</span><span class="p">]</span><span class="o">.</span><span class="n">objtype</span> <span class="ow">in</span> <span class="n">objtypes</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># NOTE: searching for exact match, object type is not considered</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">:</span>
                <span class="n">newname</span> <span class="o">=</span> <span class="n">name</span>
            <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">&#39;mod&#39;</span><span class="p">:</span>
                <span class="c1"># only exact matches allowed for modules</span>
                <span class="k">return</span> <span class="p">[]</span>
            <span class="k">elif</span> <span class="n">classname</span> <span class="ow">and</span> <span class="n">classname</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">:</span>
                <span class="n">newname</span> <span class="o">=</span> <span class="n">classname</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">name</span>
            <span class="k">elif</span> <span class="n">modname</span> <span class="ow">and</span> <span class="n">modname</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">:</span>
                <span class="n">newname</span> <span class="o">=</span> <span class="n">modname</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">name</span>
            <span class="k">elif</span> <span class="n">modname</span> <span class="ow">and</span> <span class="n">classname</span> <span class="ow">and</span> \
                    <span class="n">modname</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">classname</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">:</span>
                <span class="n">newname</span> <span class="o">=</span> <span class="n">modname</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">classname</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">name</span>
        <span class="k">if</span> <span class="n">newname</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">matches</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">newname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">newname</span><span class="p">]))</span>
        <span class="k">return</span> <span class="n">matches</span>

    <span class="k">def</span> <span class="nf">resolve_xref</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">env</span><span class="p">:</span> <span class="n">BuildEnvironment</span><span class="p">,</span> <span class="n">fromdocname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">builder</span><span class="p">:</span> <span class="n">Builder</span><span class="p">,</span>
                     <span class="nb">type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">pending_xref</span><span class="p">,</span> <span class="n">contnode</span><span class="p">:</span> <span class="n">Element</span>
                     <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Element</span><span class="p">:</span>
        <span class="n">modname</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;py:module&#39;</span><span class="p">)</span>
        <span class="n">clsname</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;py:class&#39;</span><span class="p">)</span>
        <span class="n">searchmode</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">hasattr</span><span class="p">(</span><span class="s1">&#39;refspecific&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="n">matches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_obj</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">modname</span><span class="p">,</span> <span class="n">clsname</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span>
                                <span class="nb">type</span><span class="p">,</span> <span class="n">searchmode</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">matches</span> <span class="ow">and</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">&#39;attr&#39;</span><span class="p">:</span>
            <span class="c1"># fallback to meth (for property)</span>
            <span class="n">matches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_obj</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">modname</span><span class="p">,</span> <span class="n">clsname</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="s1">&#39;meth&#39;</span><span class="p">,</span> <span class="n">searchmode</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">matches</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">__</span><span class="p">(</span><span class="s1">&#39;more than one target found for cross-reference </span><span class="si">%r</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">),</span>
                           <span class="n">target</span><span class="p">,</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">match</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">),</span>
                           <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;ref&#39;</span><span class="p">,</span> <span class="n">subtype</span><span class="o">=</span><span class="s1">&#39;python&#39;</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="n">node</span><span class="p">)</span>
        <span class="n">name</span><span class="p">,</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">matches</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">obj</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;module&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_module_refnode</span><span class="p">(</span><span class="n">builder</span><span class="p">,</span> <span class="n">fromdocname</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">contnode</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">make_refnode</span><span class="p">(</span><span class="n">builder</span><span class="p">,</span> <span class="n">fromdocname</span><span class="p">,</span> <span class="n">obj</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">obj</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">contnode</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">resolve_any_xref</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">env</span><span class="p">:</span> <span class="n">BuildEnvironment</span><span class="p">,</span> <span class="n">fromdocname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">builder</span><span class="p">:</span> <span class="n">Builder</span><span class="p">,</span>
                         <span class="n">target</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">pending_xref</span><span class="p">,</span> <span class="n">contnode</span><span class="p">:</span> <span class="n">Element</span>
                         <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Element</span><span class="p">]]:</span>
        <span class="n">modname</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;py:module&#39;</span><span class="p">)</span>
        <span class="n">clsname</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;py:class&#39;</span><span class="p">)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># type: List[Tuple[str, Element]]</span>

        <span class="c1"># always search in &quot;refspecific&quot; mode with the :any: role</span>
        <span class="n">matches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_obj</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">modname</span><span class="p">,</span> <span class="n">clsname</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">obj</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;module&#39;</span><span class="p">:</span>
                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;py:mod&#39;</span><span class="p">,</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">_make_module_refnode</span><span class="p">(</span><span class="n">builder</span><span class="p">,</span> <span class="n">fromdocname</span><span class="p">,</span>
                                                          <span class="n">name</span><span class="p">,</span> <span class="n">contnode</span><span class="p">)))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;py:&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">role_for_objtype</span><span class="p">(</span><span class="n">obj</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
                                <span class="n">make_refnode</span><span class="p">(</span><span class="n">builder</span><span class="p">,</span> <span class="n">fromdocname</span><span class="p">,</span> <span class="n">obj</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">obj</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                             <span class="n">contnode</span><span class="p">,</span> <span class="n">name</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">results</span>

    <span class="k">def</span> <span class="nf">_make_module_refnode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">builder</span><span class="p">:</span> <span class="n">Builder</span><span class="p">,</span> <span class="n">fromdocname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                             <span class="n">contnode</span><span class="p">:</span> <span class="n">Node</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Element</span><span class="p">:</span>
        <span class="c1"># get additional info for modules</span>
        <span class="n">module</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">name</span>
        <span class="k">if</span> <span class="n">module</span><span class="o">.</span><span class="n">synopsis</span><span class="p">:</span>
            <span class="n">title</span> <span class="o">+=</span> <span class="s1">&#39;: &#39;</span> <span class="o">+</span> <span class="n">module</span><span class="o">.</span><span class="n">synopsis</span>
        <span class="k">if</span> <span class="n">module</span><span class="o">.</span><span class="n">deprecated</span><span class="p">:</span>
            <span class="n">title</span> <span class="o">+=</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39; (deprecated)&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">module</span><span class="o">.</span><span class="n">platform</span><span class="p">:</span>
            <span class="n">title</span> <span class="o">+=</span> <span class="s1">&#39; (&#39;</span> <span class="o">+</span> <span class="n">module</span><span class="o">.</span><span class="n">platform</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
        <span class="k">return</span> <span class="n">make_refnode</span><span class="p">(</span><span class="n">builder</span><span class="p">,</span> <span class="n">fromdocname</span><span class="p">,</span> <span class="n">module</span><span class="o">.</span><span class="n">docname</span><span class="p">,</span> <span class="n">module</span><span class="o">.</span><span class="n">node_id</span><span class="p">,</span>
                            <span class="n">contnode</span><span class="p">,</span> <span class="n">title</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_objects</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
        <span class="k">for</span> <span class="n">modname</span><span class="p">,</span> <span class="n">mod</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">yield</span> <span class="p">(</span><span class="n">modname</span><span class="p">,</span> <span class="n">modname</span><span class="p">,</span> <span class="s1">&#39;module&#39;</span><span class="p">,</span> <span class="n">mod</span><span class="o">.</span><span class="n">docname</span><span class="p">,</span> <span class="n">mod</span><span class="o">.</span><span class="n">node_id</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">refname</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">objtype</span> <span class="o">!=</span> <span class="s1">&#39;module&#39;</span><span class="p">:</span>  <span class="c1"># modules are already handled</span>
                <span class="k">yield</span> <span class="p">(</span><span class="n">refname</span><span class="p">,</span> <span class="n">refname</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">objtype</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">docname</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">node_id</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_full_qualified_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">Element</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">modname</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;py:module&#39;</span><span class="p">)</span>
        <span class="n">clsname</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;py:class&#39;</span><span class="p">)</span>
        <span class="n">target</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;reftarget&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">target</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="p">[</span><span class="n">modname</span><span class="p">,</span> <span class="n">clsname</span><span class="p">,</span> <span class="n">target</span><span class="p">]))</span></div>


<span class="k">def</span> <span class="nf">builtin_resolver</span><span class="p">(</span><span class="n">app</span><span class="p">:</span> <span class="n">Sphinx</span><span class="p">,</span> <span class="n">env</span><span class="p">:</span> <span class="n">BuildEnvironment</span><span class="p">,</span>
                     <span class="n">node</span><span class="p">:</span> <span class="n">pending_xref</span><span class="p">,</span> <span class="n">contnode</span><span class="p">:</span> <span class="n">Element</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Element</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Do not emit nitpicky warnings for built-in types.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">istyping</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;typing.&#39;</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">typing</span><span class="o">.</span><span class="n">__all__</span>  <span class="c1"># type: ignore</span>

    <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;refdomain&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">&#39;py&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">elif</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;reftype&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;class&#39;</span><span class="p">,</span> <span class="s1">&#39;obj&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;reftarget&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">contnode</span>
    <span class="k">elif</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;reftype&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;class&#39;</span><span class="p">,</span> <span class="s1">&#39;exc&#39;</span><span class="p">):</span>
        <span class="n">reftarget</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;reftarget&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isclass</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">builtins</span><span class="p">,</span> <span class="n">reftarget</span><span class="p">,</span> <span class="kc">None</span><span class="p">)):</span>
            <span class="c1"># built-in class</span>
            <span class="k">return</span> <span class="n">contnode</span>
        <span class="k">elif</span> <span class="n">istyping</span><span class="p">(</span><span class="n">reftarget</span><span class="p">):</span>
            <span class="c1"># typing class</span>
            <span class="k">return</span> <span class="n">contnode</span>

    <span class="k">return</span> <span class="kc">None</span>


<span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="n">app</span><span class="p">:</span> <span class="n">Sphinx</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">setup_extension</span><span class="p">(</span><span class="s1">&#39;sphinx.directives&#39;</span><span class="p">)</span>

    <span class="n">app</span><span class="o">.</span><span class="n">add_domain</span><span class="p">(</span><span class="n">PythonDomain</span><span class="p">)</span>
    <span class="n">app</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;object-description-transform&#39;</span><span class="p">,</span> <span class="n">filter_meta_fields</span><span class="p">)</span>
    <span class="n">app</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;missing-reference&#39;</span><span class="p">,</span> <span class="n">builtin_resolver</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">900</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;version&#39;</span><span class="p">:</span> <span class="s1">&#39;builtin&#39;</span><span class="p">,</span>
        <span class="s1">&#39;env_version&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="s1">&#39;parallel_read_safe&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">&#39;parallel_write_safe&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">}</span>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">Sphinx home</a>&#160;|</li>
        <li><a href="../../../contents.html">Documentation</a> &#187;</li>

          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../domains.html" >sphinx.domains</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">sphinx.domains.python</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2007-2021, Georg Brandl and the Sphinx team.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.5.4.
    </div>
  </body>
</html>