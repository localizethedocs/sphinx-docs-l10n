<!DOCTYPE html>

<html lang="zh-TW" data-content_root="../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>sphinx.domains.python &#8212; Sphinx documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=b86133f3" />
    <link rel="stylesheet" type="text/css" href="../../../_static/basic.css?v=fb9458d3" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=fd3f3429" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx13.css?v=4e502a7e" />
    <script src="../../../_static/documentation_options.js?v=f906b030"></script>
    <script src="../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/translations.js?v=f1e884e3"></script>
    <link rel="canonical" href="https://projects.localizethedocs.org/sphinx-docs-l10n/_modules/sphinx/domains/python.html" />
    <link rel="search" type="application/opensearchdescription+xml"
          title="在 Sphinx documentation 中搜尋"
          href="../../../_static/opensearch.xml"/>
    <link rel="icon" href="../../../_static/favicon.svg"/>
    <link rel="index" title="索引" href="../../../genindex.html" />
    <link rel="search" title="搜尋" href="../../../search.html" />

 

<script type="text/javascript" src="../../../ltd-provenance.js"></script>
<script type="text/javascript" src="../../../ltd-current.js"></script>
<script type="text/javascript" src="../../../../../ltd-config.js"></script>
<script type="text/javascript" src="../../../../../ltd-flyout.js"></script>

  </head><body>

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="github" viewBox="0 0 16 16">
    <title>GitHub</title>
    <svg
      stroke="currentColor"
      fill="currentColor"
      stroke-width="0"
      viewBox="0 0 16 16"
    >
      <path
        fill-rule="evenodd"
        d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"
      ></path>
    </svg>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
</svg>

<div class="pageheader">
  <div class="brand">
    <a href="../../../index.html">
      <img src="../../../_static/sphinx-logo.svg" alt="logo" />
    </a>
    <h1>Sphinx</h1>
  </div>
  <div class="icons">
    <a href="https://github.com/sphinx-doc/sphinx" title="Source Code" target="_blank">
      <svg><use href="#github"></use></svg>
    </a>
  </div>
</div>

<div class="related" role="navigation" aria-label="Related">
  <h3>瀏覽</h3>
  <ul>
    <li><a href="../../../index.html">Documentation</a> &raquo;</li>
      <li class="nav-item nav-item-1"><a href="../../index.html" >模組原始碼</a> &#187;</li>
      <li class="nav-item nav-item-2"><a href="../domains.html" accesskey="U">sphinx.domains</a> &#187;</li>
    <li class="nav-item nav-item-this"><a href="">sphinx.domains.python</a></li>
  </ul>
</div>

<div class="document">
  <div class="sphinxsidebar" role="navigation" aria-label="Main">
<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="前往" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
    <div class="sphinxsidebar-navigation__pages">
      <p class="caption" role="heading"><span class="caption-text">基礎知識</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../usage/installation.html">安裝 Sphinx</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usage/quickstart.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial/index.html">建置您的第一個專案</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../usage/index.html">使用 Sphinx</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../development/index.html">擴充 Sphinx</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../extdev/index.html">Sphinx API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../latex.html">LaTeX customization</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">社群</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../support.html">獲取支援</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../internals/index.html">貢獻 Sphinx</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../faq.html">Sphinx 常見問題</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../authors.html">Sphinx 作者群</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">參考手冊</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../man/index.html">Command-Line Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usage/configuration.html">組態</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usage/extensions/index.html">擴充功能</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usage/restructuredtext/index.html">reStructuredText</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../glossary.html">詞彙表</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../changes.html">變更日誌</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples.html">使用 Sphinx 的專案</a></li>
</ul>

    </div>
  </div>
  <div class="body" role="main">
    
  <h1>sphinx.domains.python 的原始碼</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;The Python domain.&quot;&quot;&quot;</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">builtins</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">inspect</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">typing</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">TYPE_CHECKING</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">ClassVar</span><span class="p">,</span> <span class="n">NamedTuple</span><span class="p">,</span> <span class="n">cast</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">docutils</span><span class="w"> </span><span class="kn">import</span> <span class="n">nodes</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">docutils.parsers.rst</span><span class="w"> </span><span class="kn">import</span> <span class="n">directives</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">sphinx</span><span class="w"> </span><span class="kn">import</span> <span class="n">addnodes</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sphinx.domains</span><span class="w"> </span><span class="kn">import</span> <span class="n">Domain</span><span class="p">,</span> <span class="n">Index</span><span class="p">,</span> <span class="n">IndexEntry</span><span class="p">,</span> <span class="n">ObjType</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sphinx.domains.python._annotations</span><span class="w"> </span><span class="kn">import</span> <span class="n">_parse_annotation</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sphinx.domains.python._object</span><span class="w"> </span><span class="kn">import</span> <span class="n">PyObject</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sphinx.locale</span><span class="w"> </span><span class="kn">import</span> <span class="n">_</span><span class="p">,</span> <span class="n">__</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sphinx.roles</span><span class="w"> </span><span class="kn">import</span> <span class="n">XRefRole</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sphinx.util</span><span class="w"> </span><span class="kn">import</span> <span class="n">logging</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sphinx.util.docutils</span><span class="w"> </span><span class="kn">import</span> <span class="n">SphinxDirective</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sphinx.util.nodes</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">find_pending_xref_condition</span><span class="p">,</span>
    <span class="n">make_id</span><span class="p">,</span>
    <span class="n">make_refnode</span><span class="p">,</span>
<span class="p">)</span>

<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">collections.abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">Iterable</span><span class="p">,</span> <span class="n">Iterator</span>

    <span class="kn">from</span><span class="w"> </span><span class="nn">docutils.nodes</span><span class="w"> </span><span class="kn">import</span> <span class="n">Element</span><span class="p">,</span> <span class="n">Node</span>

    <span class="kn">from</span><span class="w"> </span><span class="nn">sphinx.addnodes</span><span class="w"> </span><span class="kn">import</span> <span class="n">desc_signature</span><span class="p">,</span> <span class="n">pending_xref</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">sphinx.application</span><span class="w"> </span><span class="kn">import</span> <span class="n">Sphinx</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">sphinx.builders</span><span class="w"> </span><span class="kn">import</span> <span class="n">Builder</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">sphinx.environment</span><span class="w"> </span><span class="kn">import</span> <span class="n">BuildEnvironment</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">sphinx.util.typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">ExtensionMetadata</span><span class="p">,</span> <span class="n">OptionSpec</span>

<span class="c1"># re-export objects for backwards compatibility</span>
<span class="c1"># xref https://github.com/sphinx-doc/sphinx/issues/12295</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sphinx.domains.python._annotations</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>  <span class="c1"># NoQA: F401</span>
    <span class="n">_parse_arglist</span><span class="p">,</span>  <span class="c1"># for sphinx-immaterial</span>
    <span class="n">type_to_xref</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sphinx.domains.python._object</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>  <span class="c1"># NoQA: F401</span>
    <span class="n">PyField</span><span class="p">,</span>
    <span class="n">PyGroupedField</span><span class="p">,</span>
    <span class="n">PyTypedField</span><span class="p">,</span>
    <span class="n">PyXrefMixin</span><span class="p">,</span>
    <span class="n">py_sig_re</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="n">pairindextypes</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;module&#39;</span><span class="p">:</span> <span class="s1">&#39;module&#39;</span><span class="p">,</span>
    <span class="s1">&#39;keyword&#39;</span><span class="p">:</span> <span class="s1">&#39;keyword&#39;</span><span class="p">,</span>
    <span class="s1">&#39;operator&#39;</span><span class="p">:</span> <span class="s1">&#39;operator&#39;</span><span class="p">,</span>
    <span class="s1">&#39;object&#39;</span><span class="p">:</span> <span class="s1">&#39;object&#39;</span><span class="p">,</span>
    <span class="s1">&#39;exception&#39;</span><span class="p">:</span> <span class="s1">&#39;exception&#39;</span><span class="p">,</span>
    <span class="s1">&#39;statement&#39;</span><span class="p">:</span> <span class="s1">&#39;statement&#39;</span><span class="p">,</span>
    <span class="s1">&#39;builtin&#39;</span><span class="p">:</span> <span class="s1">&#39;built-in function&#39;</span><span class="p">,</span>
<span class="p">}</span>


<span class="k">class</span><span class="w"> </span><span class="nc">ObjectEntry</span><span class="p">(</span><span class="n">NamedTuple</span><span class="p">):</span>
    <span class="n">docname</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">node_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">objtype</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">aliased</span><span class="p">:</span> <span class="nb">bool</span>


<span class="k">class</span><span class="w"> </span><span class="nc">ModuleEntry</span><span class="p">(</span><span class="n">NamedTuple</span><span class="p">):</span>
    <span class="n">docname</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">node_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">synopsis</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">platform</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">deprecated</span><span class="p">:</span> <span class="nb">bool</span>


<span class="k">class</span><span class="w"> </span><span class="nc">PyFunction</span><span class="p">(</span><span class="n">PyObject</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Description of a function.&quot;&quot;&quot;</span>

    <span class="n">option_spec</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">OptionSpec</span><span class="p">]</span> <span class="o">=</span> <span class="n">PyObject</span><span class="o">.</span><span class="n">option_spec</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>  <span class="c1"># noqa: F821</span>
    <span class="n">option_spec</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
        <span class="s1">&#39;async&#39;</span><span class="p">:</span> <span class="n">directives</span><span class="o">.</span><span class="n">flag</span><span class="p">,</span>
    <span class="p">})</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_signature_prefix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sig</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">nodes</span><span class="o">.</span><span class="n">Node</span><span class="p">]:</span>
        <span class="k">if</span> <span class="s1">&#39;async&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">addnodes</span><span class="o">.</span><span class="n">desc_sig_keyword</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;async&#39;</span><span class="p">),</span>
                    <span class="n">addnodes</span><span class="o">.</span><span class="n">desc_sig_space</span><span class="p">()]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">needs_arglist</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_target_and_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name_cls</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">sig</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                             <span class="n">signode</span><span class="p">:</span> <span class="n">desc_signature</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">add_target_and_index</span><span class="p">(</span><span class="n">name_cls</span><span class="p">,</span> <span class="n">sig</span><span class="p">,</span> <span class="n">signode</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;no-index-entry&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
            <span class="n">modname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;module&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">ref_context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;py:module&#39;</span><span class="p">))</span>
            <span class="n">node_id</span> <span class="o">=</span> <span class="n">signode</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">name</span><span class="p">,</span> <span class="bp">cls</span> <span class="o">=</span> <span class="n">name_cls</span>
            <span class="k">if</span> <span class="n">modname</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">() (in module </span><span class="si">%s</span><span class="s1">)&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">modname</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">indexnode</span><span class="p">[</span><span class="s1">&#39;entries&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;single&#39;</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">node_id</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;built-in function; </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">()&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">indexnode</span><span class="p">[</span><span class="s1">&#39;entries&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;pair&#39;</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">node_id</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_index_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">name_cls</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="c1"># add index in own add_target_and_index() instead.</span>
        <span class="k">return</span> <span class="s1">&#39;&#39;</span>


<span class="k">class</span><span class="w"> </span><span class="nc">PyDecoratorFunction</span><span class="p">(</span><span class="n">PyFunction</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Description of a decorator.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Node</span><span class="p">]:</span>
        <span class="c1"># a decorator function is a function after all</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;py:function&#39;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">handle_signature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sig</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">signode</span><span class="p">:</span> <span class="n">desc_signature</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">handle_signature</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span> <span class="n">signode</span><span class="p">)</span>
        <span class="n">signode</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">addnodes</span><span class="o">.</span><span class="n">desc_addname</span><span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">,</span> <span class="s1">&#39;@&#39;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">ret</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">needs_arglist</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>


<span class="k">class</span><span class="w"> </span><span class="nc">PyVariable</span><span class="p">(</span><span class="n">PyObject</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Description of a variable.&quot;&quot;&quot;</span>

    <span class="n">option_spec</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">OptionSpec</span><span class="p">]</span> <span class="o">=</span> <span class="n">PyObject</span><span class="o">.</span><span class="n">option_spec</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">option_spec</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
        <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">directives</span><span class="o">.</span><span class="n">unchanged</span><span class="p">,</span>
        <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">directives</span><span class="o">.</span><span class="n">unchanged</span><span class="p">,</span>
    <span class="p">})</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">handle_signature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sig</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">signode</span><span class="p">:</span> <span class="n">desc_signature</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
        <span class="n">fullname</span><span class="p">,</span> <span class="n">prefix</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">handle_signature</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span> <span class="n">signode</span><span class="p">)</span>

        <span class="n">typ</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">typ</span><span class="p">:</span>
            <span class="n">annotations</span> <span class="o">=</span> <span class="n">_parse_annotation</span><span class="p">(</span><span class="n">typ</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">)</span>
            <span class="n">signode</span> <span class="o">+=</span> <span class="n">addnodes</span><span class="o">.</span><span class="n">desc_annotation</span><span class="p">(</span><span class="n">typ</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                                                <span class="n">addnodes</span><span class="o">.</span><span class="n">desc_sig_punctuation</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">),</span>
                                                <span class="n">addnodes</span><span class="o">.</span><span class="n">desc_sig_space</span><span class="p">(),</span> <span class="o">*</span><span class="n">annotations</span><span class="p">)</span>

        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span><span class="p">:</span>
            <span class="n">signode</span> <span class="o">+=</span> <span class="n">addnodes</span><span class="o">.</span><span class="n">desc_annotation</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                                                <span class="n">addnodes</span><span class="o">.</span><span class="n">desc_sig_space</span><span class="p">(),</span>
                                                <span class="n">addnodes</span><span class="o">.</span><span class="n">desc_sig_punctuation</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">),</span>
                                                <span class="n">addnodes</span><span class="o">.</span><span class="n">desc_sig_space</span><span class="p">(),</span>
                                                <span class="n">nodes</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">fullname</span><span class="p">,</span> <span class="n">prefix</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_index_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">name_cls</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">name</span><span class="p">,</span> <span class="bp">cls</span> <span class="o">=</span> <span class="n">name_cls</span>
        <span class="k">if</span> <span class="n">modname</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> (in module </span><span class="si">%s</span><span class="s1">)&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">modname</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> (built-in variable)&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="n">name</span>


<span class="k">class</span><span class="w"> </span><span class="nc">PyClasslike</span><span class="p">(</span><span class="n">PyObject</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Description of a class-like object (classes, interfaces, exceptions).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">option_spec</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">OptionSpec</span><span class="p">]</span> <span class="o">=</span> <span class="n">PyObject</span><span class="o">.</span><span class="n">option_spec</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">option_spec</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
        <span class="s1">&#39;final&#39;</span><span class="p">:</span> <span class="n">directives</span><span class="o">.</span><span class="n">flag</span><span class="p">,</span>
    <span class="p">})</span>

    <span class="n">allow_nesting</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_signature_prefix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sig</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">nodes</span><span class="o">.</span><span class="n">Node</span><span class="p">]:</span>
        <span class="k">if</span> <span class="s1">&#39;final&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">nodes</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;final&#39;</span><span class="p">),</span> <span class="n">addnodes</span><span class="o">.</span><span class="n">desc_sig_space</span><span class="p">(),</span>
                    <span class="n">nodes</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">objtype</span><span class="p">),</span> <span class="n">addnodes</span><span class="o">.</span><span class="n">desc_sig_space</span><span class="p">()]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">nodes</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">objtype</span><span class="p">),</span> <span class="n">addnodes</span><span class="o">.</span><span class="n">desc_sig_space</span><span class="p">()]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_index_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">name_cls</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">objtype</span> <span class="o">==</span> <span class="s1">&#39;class&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">modname</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> (built-in class)&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="n">name_cls</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> (class in </span><span class="si">%s</span><span class="s1">)&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">name_cls</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">modname</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">objtype</span> <span class="o">==</span> <span class="s1">&#39;exception&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">name_cls</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;&#39;</span>


<span class="k">class</span><span class="w"> </span><span class="nc">PyMethod</span><span class="p">(</span><span class="n">PyObject</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Description of a method.&quot;&quot;&quot;</span>

    <span class="n">option_spec</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">OptionSpec</span><span class="p">]</span> <span class="o">=</span> <span class="n">PyObject</span><span class="o">.</span><span class="n">option_spec</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">option_spec</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
        <span class="s1">&#39;abstractmethod&#39;</span><span class="p">:</span> <span class="n">directives</span><span class="o">.</span><span class="n">flag</span><span class="p">,</span>
        <span class="s1">&#39;async&#39;</span><span class="p">:</span> <span class="n">directives</span><span class="o">.</span><span class="n">flag</span><span class="p">,</span>
        <span class="s1">&#39;classmethod&#39;</span><span class="p">:</span> <span class="n">directives</span><span class="o">.</span><span class="n">flag</span><span class="p">,</span>
        <span class="s1">&#39;final&#39;</span><span class="p">:</span> <span class="n">directives</span><span class="o">.</span><span class="n">flag</span><span class="p">,</span>
        <span class="s1">&#39;staticmethod&#39;</span><span class="p">:</span> <span class="n">directives</span><span class="o">.</span><span class="n">flag</span><span class="p">,</span>
    <span class="p">})</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">needs_arglist</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_signature_prefix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sig</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">nodes</span><span class="o">.</span><span class="n">Node</span><span class="p">]:</span>
        <span class="n">prefix</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">nodes</span><span class="o">.</span><span class="n">Node</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="s1">&#39;final&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
            <span class="n">prefix</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nodes</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;final&#39;</span><span class="p">))</span>
            <span class="n">prefix</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">addnodes</span><span class="o">.</span><span class="n">desc_sig_space</span><span class="p">())</span>
        <span class="k">if</span> <span class="s1">&#39;abstractmethod&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
            <span class="n">prefix</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nodes</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;abstract&#39;</span><span class="p">))</span>
            <span class="n">prefix</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">addnodes</span><span class="o">.</span><span class="n">desc_sig_space</span><span class="p">())</span>
        <span class="k">if</span> <span class="s1">&#39;async&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
            <span class="n">prefix</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nodes</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;async&#39;</span><span class="p">))</span>
            <span class="n">prefix</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">addnodes</span><span class="o">.</span><span class="n">desc_sig_space</span><span class="p">())</span>
        <span class="k">if</span> <span class="s1">&#39;classmethod&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
            <span class="n">prefix</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nodes</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;classmethod&#39;</span><span class="p">))</span>
            <span class="n">prefix</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">addnodes</span><span class="o">.</span><span class="n">desc_sig_space</span><span class="p">())</span>
        <span class="k">if</span> <span class="s1">&#39;staticmethod&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
            <span class="n">prefix</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nodes</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;static&#39;</span><span class="p">))</span>
            <span class="n">prefix</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">addnodes</span><span class="o">.</span><span class="n">desc_sig_space</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">prefix</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_index_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">name_cls</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">name</span><span class="p">,</span> <span class="bp">cls</span> <span class="o">=</span> <span class="n">name_cls</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">clsname</span><span class="p">,</span> <span class="n">methname</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">modname</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">add_module_names</span><span class="p">:</span>
                <span class="n">clsname</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">modname</span><span class="si">}</span><span class="s1">.</span><span class="si">{</span><span class="n">clsname</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">modname</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">() (in module </span><span class="si">%s</span><span class="s1">)&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">modname</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">()&#39;</span> <span class="o">%</span> <span class="n">name</span>

        <span class="k">if</span> <span class="s1">&#39;classmethod&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">() (</span><span class="si">%s</span><span class="s1"> class method)&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">methname</span><span class="p">,</span> <span class="n">clsname</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s1">&#39;staticmethod&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">() (</span><span class="si">%s</span><span class="s1"> static method)&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">methname</span><span class="p">,</span> <span class="n">clsname</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">() (</span><span class="si">%s</span><span class="s1"> method)&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">methname</span><span class="p">,</span> <span class="n">clsname</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">PyClassMethod</span><span class="p">(</span><span class="n">PyMethod</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Description of a classmethod.&quot;&quot;&quot;</span>

    <span class="n">option_spec</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">OptionSpec</span><span class="p">]</span> <span class="o">=</span> <span class="n">PyObject</span><span class="o">.</span><span class="n">option_spec</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Node</span><span class="p">]:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;py:method&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;classmethod&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>


<span class="k">class</span><span class="w"> </span><span class="nc">PyStaticMethod</span><span class="p">(</span><span class="n">PyMethod</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Description of a staticmethod.&quot;&quot;&quot;</span>

    <span class="n">option_spec</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">OptionSpec</span><span class="p">]</span> <span class="o">=</span> <span class="n">PyObject</span><span class="o">.</span><span class="n">option_spec</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Node</span><span class="p">]:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;py:method&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s1">&#39;staticmethod&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>


<span class="k">class</span><span class="w"> </span><span class="nc">PyDecoratorMethod</span><span class="p">(</span><span class="n">PyMethod</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Description of a decoratormethod.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Node</span><span class="p">]:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;py:method&#39;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">handle_signature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sig</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">signode</span><span class="p">:</span> <span class="n">desc_signature</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">handle_signature</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span> <span class="n">signode</span><span class="p">)</span>
        <span class="n">signode</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">addnodes</span><span class="o">.</span><span class="n">desc_addname</span><span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">,</span> <span class="s1">&#39;@&#39;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">ret</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">needs_arglist</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>


<span class="k">class</span><span class="w"> </span><span class="nc">PyAttribute</span><span class="p">(</span><span class="n">PyObject</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Description of an attribute.&quot;&quot;&quot;</span>

    <span class="n">option_spec</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">OptionSpec</span><span class="p">]</span> <span class="o">=</span> <span class="n">PyObject</span><span class="o">.</span><span class="n">option_spec</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">option_spec</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
        <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">directives</span><span class="o">.</span><span class="n">unchanged</span><span class="p">,</span>
        <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">directives</span><span class="o">.</span><span class="n">unchanged</span><span class="p">,</span>
    <span class="p">})</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">handle_signature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sig</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">signode</span><span class="p">:</span> <span class="n">desc_signature</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
        <span class="n">fullname</span><span class="p">,</span> <span class="n">prefix</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">handle_signature</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span> <span class="n">signode</span><span class="p">)</span>

        <span class="n">typ</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">typ</span><span class="p">:</span>
            <span class="n">annotations</span> <span class="o">=</span> <span class="n">_parse_annotation</span><span class="p">(</span><span class="n">typ</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">)</span>
            <span class="n">signode</span> <span class="o">+=</span> <span class="n">addnodes</span><span class="o">.</span><span class="n">desc_annotation</span><span class="p">(</span><span class="n">typ</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                                                <span class="n">addnodes</span><span class="o">.</span><span class="n">desc_sig_punctuation</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">),</span>
                                                <span class="n">addnodes</span><span class="o">.</span><span class="n">desc_sig_space</span><span class="p">(),</span>
                                                <span class="o">*</span><span class="n">annotations</span><span class="p">)</span>

        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span><span class="p">:</span>
            <span class="n">signode</span> <span class="o">+=</span> <span class="n">addnodes</span><span class="o">.</span><span class="n">desc_annotation</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                                                <span class="n">addnodes</span><span class="o">.</span><span class="n">desc_sig_space</span><span class="p">(),</span>
                                                <span class="n">addnodes</span><span class="o">.</span><span class="n">desc_sig_punctuation</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">),</span>
                                                <span class="n">addnodes</span><span class="o">.</span><span class="n">desc_sig_space</span><span class="p">(),</span>
                                                <span class="n">nodes</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">fullname</span><span class="p">,</span> <span class="n">prefix</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_index_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">name_cls</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">name</span><span class="p">,</span> <span class="bp">cls</span> <span class="o">=</span> <span class="n">name_cls</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">clsname</span><span class="p">,</span> <span class="n">attrname</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">modname</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">add_module_names</span><span class="p">:</span>
                <span class="n">clsname</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">modname</span><span class="si">}</span><span class="s1">.</span><span class="si">{</span><span class="n">clsname</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">modname</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> (in module </span><span class="si">%s</span><span class="s1">)&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">modname</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">name</span>

        <span class="k">return</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> (</span><span class="si">%s</span><span class="s1"> attribute)&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">attrname</span><span class="p">,</span> <span class="n">clsname</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">PyProperty</span><span class="p">(</span><span class="n">PyObject</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Description of an attribute.&quot;&quot;&quot;</span>

    <span class="n">option_spec</span> <span class="o">=</span> <span class="n">PyObject</span><span class="o">.</span><span class="n">option_spec</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">option_spec</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
        <span class="s1">&#39;abstractmethod&#39;</span><span class="p">:</span> <span class="n">directives</span><span class="o">.</span><span class="n">flag</span><span class="p">,</span>
        <span class="s1">&#39;classmethod&#39;</span><span class="p">:</span> <span class="n">directives</span><span class="o">.</span><span class="n">flag</span><span class="p">,</span>
        <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">directives</span><span class="o">.</span><span class="n">unchanged</span><span class="p">,</span>
    <span class="p">})</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">handle_signature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sig</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">signode</span><span class="p">:</span> <span class="n">desc_signature</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
        <span class="n">fullname</span><span class="p">,</span> <span class="n">prefix</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">handle_signature</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span> <span class="n">signode</span><span class="p">)</span>

        <span class="n">typ</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">typ</span><span class="p">:</span>
            <span class="n">annotations</span> <span class="o">=</span> <span class="n">_parse_annotation</span><span class="p">(</span><span class="n">typ</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">)</span>
            <span class="n">signode</span> <span class="o">+=</span> <span class="n">addnodes</span><span class="o">.</span><span class="n">desc_annotation</span><span class="p">(</span><span class="n">typ</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                                                <span class="n">addnodes</span><span class="o">.</span><span class="n">desc_sig_punctuation</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">),</span>
                                                <span class="n">addnodes</span><span class="o">.</span><span class="n">desc_sig_space</span><span class="p">(),</span>
                                                <span class="o">*</span><span class="n">annotations</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fullname</span><span class="p">,</span> <span class="n">prefix</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_signature_prefix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sig</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">nodes</span><span class="o">.</span><span class="n">Node</span><span class="p">]:</span>
        <span class="n">prefix</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">nodes</span><span class="o">.</span><span class="n">Node</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="s1">&#39;abstractmethod&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
            <span class="n">prefix</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nodes</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;abstract&#39;</span><span class="p">))</span>
            <span class="n">prefix</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">addnodes</span><span class="o">.</span><span class="n">desc_sig_space</span><span class="p">())</span>
        <span class="k">if</span> <span class="s1">&#39;classmethod&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
            <span class="n">prefix</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nodes</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;class&#39;</span><span class="p">))</span>
            <span class="n">prefix</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">addnodes</span><span class="o">.</span><span class="n">desc_sig_space</span><span class="p">())</span>

        <span class="n">prefix</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nodes</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;property&#39;</span><span class="p">))</span>
        <span class="n">prefix</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">addnodes</span><span class="o">.</span><span class="n">desc_sig_space</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">prefix</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_index_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">name_cls</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">name</span><span class="p">,</span> <span class="bp">cls</span> <span class="o">=</span> <span class="n">name_cls</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">clsname</span><span class="p">,</span> <span class="n">attrname</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">modname</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">add_module_names</span><span class="p">:</span>
                <span class="n">clsname</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">modname</span><span class="si">}</span><span class="s1">.</span><span class="si">{</span><span class="n">clsname</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">modname</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> (in module </span><span class="si">%s</span><span class="s1">)&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">modname</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">name</span>

        <span class="k">return</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> (</span><span class="si">%s</span><span class="s1"> property)&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">attrname</span><span class="p">,</span> <span class="n">clsname</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">PyTypeAlias</span><span class="p">(</span><span class="n">PyObject</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Description of a type alias.&quot;&quot;&quot;</span>

    <span class="n">option_spec</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">OptionSpec</span><span class="p">]</span> <span class="o">=</span> <span class="n">PyObject</span><span class="o">.</span><span class="n">option_spec</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">option_spec</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
        <span class="s1">&#39;canonical&#39;</span><span class="p">:</span> <span class="n">directives</span><span class="o">.</span><span class="n">unchanged</span><span class="p">,</span>
    <span class="p">})</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_signature_prefix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sig</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">nodes</span><span class="o">.</span><span class="n">Node</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">nodes</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">),</span> <span class="n">addnodes</span><span class="o">.</span><span class="n">desc_sig_space</span><span class="p">()]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">handle_signature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sig</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">signode</span><span class="p">:</span> <span class="n">desc_signature</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
        <span class="n">fullname</span><span class="p">,</span> <span class="n">prefix</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">handle_signature</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span> <span class="n">signode</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">canonical</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;canonical&#39;</span><span class="p">):</span>
            <span class="n">canonical_annotations</span> <span class="o">=</span> <span class="n">_parse_annotation</span><span class="p">(</span><span class="n">canonical</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">)</span>
            <span class="n">signode</span> <span class="o">+=</span> <span class="n">addnodes</span><span class="o">.</span><span class="n">desc_annotation</span><span class="p">(</span>
                <span class="n">canonical</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                <span class="n">addnodes</span><span class="o">.</span><span class="n">desc_sig_space</span><span class="p">(),</span>
                <span class="n">addnodes</span><span class="o">.</span><span class="n">desc_sig_punctuation</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">),</span>
                <span class="n">addnodes</span><span class="o">.</span><span class="n">desc_sig_space</span><span class="p">(),</span>
                <span class="o">*</span><span class="n">canonical_annotations</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">fullname</span><span class="p">,</span> <span class="n">prefix</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_index_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">name_cls</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">name</span><span class="p">,</span> <span class="bp">cls</span> <span class="o">=</span> <span class="n">name_cls</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">clsname</span><span class="p">,</span> <span class="n">attrname</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">modname</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">add_module_names</span><span class="p">:</span>
                <span class="n">clsname</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">modname</span><span class="si">}</span><span class="s1">.</span><span class="si">{</span><span class="n">clsname</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">modname</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> (in module </span><span class="si">%s</span><span class="s1">)&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">modname</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">name</span>

        <span class="k">return</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> (type alias in </span><span class="si">%s</span><span class="s1">)&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">attrname</span><span class="p">,</span> <span class="n">clsname</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">PyModule</span><span class="p">(</span><span class="n">SphinxDirective</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Directive to mark description of a new module.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">has_content</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">required_arguments</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">optional_arguments</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">final_argument_whitespace</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">option_spec</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">OptionSpec</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;platform&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span>
        <span class="s1">&#39;synopsis&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span>
        <span class="s1">&#39;no-index&#39;</span><span class="p">:</span> <span class="n">directives</span><span class="o">.</span><span class="n">flag</span><span class="p">,</span>
        <span class="s1">&#39;no-contents-entry&#39;</span><span class="p">:</span> <span class="n">directives</span><span class="o">.</span><span class="n">flag</span><span class="p">,</span>
        <span class="s1">&#39;no-typesetting&#39;</span><span class="p">:</span> <span class="n">directives</span><span class="o">.</span><span class="n">flag</span><span class="p">,</span>
        <span class="s1">&#39;noindex&#39;</span><span class="p">:</span> <span class="n">directives</span><span class="o">.</span><span class="n">flag</span><span class="p">,</span>
        <span class="s1">&#39;nocontentsentry&#39;</span><span class="p">:</span> <span class="n">directives</span><span class="o">.</span><span class="n">flag</span><span class="p">,</span>
        <span class="s1">&#39;deprecated&#39;</span><span class="p">:</span> <span class="n">directives</span><span class="o">.</span><span class="n">flag</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Node</span><span class="p">]:</span>
        <span class="n">domain</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">PythonDomain</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">get_domain</span><span class="p">(</span><span class="s1">&#39;py&#39;</span><span class="p">))</span>

        <span class="n">modname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">no_index</span> <span class="o">=</span> <span class="s1">&#39;no-index&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">ref_context</span><span class="p">[</span><span class="s1">&#39;py:module&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">modname</span>

        <span class="n">content_nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_content_to_nodes</span><span class="p">(</span><span class="n">allow_section_headings</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">ret</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Node</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">no_index</span><span class="p">:</span>
            <span class="c1"># note module to the domain</span>
            <span class="n">node_id</span> <span class="o">=</span> <span class="n">make_id</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">document</span><span class="p">,</span> <span class="s1">&#39;module&#39;</span><span class="p">,</span> <span class="n">modname</span><span class="p">)</span>
            <span class="n">target</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">target</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">ids</span><span class="o">=</span><span class="p">[</span><span class="n">node_id</span><span class="p">],</span> <span class="n">ismod</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_source_info</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">document</span><span class="o">.</span><span class="n">note_explicit_target</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>

            <span class="n">domain</span><span class="o">.</span><span class="n">note_module</span><span class="p">(</span><span class="n">modname</span><span class="p">,</span>
                               <span class="n">node_id</span><span class="p">,</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;synopsis&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;platform&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
                               <span class="s1">&#39;deprecated&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
            <span class="n">domain</span><span class="o">.</span><span class="n">note_object</span><span class="p">(</span><span class="n">modname</span><span class="p">,</span> <span class="s1">&#39;module&#39;</span><span class="p">,</span> <span class="n">node_id</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="n">target</span><span class="p">)</span>

            <span class="c1"># the platform and synopsis aren&#39;t printed; in fact, they are only</span>
            <span class="c1"># used in the modindex currently</span>
            <span class="n">indextext</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;module; </span><span class="si">{</span><span class="n">modname</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="n">inode</span> <span class="o">=</span> <span class="n">addnodes</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">entries</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;pair&#39;</span><span class="p">,</span> <span class="n">indextext</span><span class="p">,</span> <span class="n">node_id</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)])</span>
            <span class="c1"># The node order is: index node first, then target node.</span>
            <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inode</span><span class="p">)</span>
            <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
        <span class="n">ret</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">content_nodes</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span>


<span class="k">class</span><span class="w"> </span><span class="nc">PyCurrentModule</span><span class="p">(</span><span class="n">SphinxDirective</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This directive is just to tell Sphinx that we&#39;re documenting</span>
<span class="sd">    stuff in module foo, but links to module foo won&#39;t lead here.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">has_content</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">required_arguments</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">optional_arguments</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">final_argument_whitespace</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">option_spec</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">OptionSpec</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Node</span><span class="p">]:</span>
        <span class="n">modname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">modname</span> <span class="o">==</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">ref_context</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;py:module&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">ref_context</span><span class="p">[</span><span class="s1">&#39;py:module&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">modname</span>
        <span class="k">return</span> <span class="p">[]</span>


<span class="k">class</span><span class="w"> </span><span class="nc">PyXRefRole</span><span class="p">(</span><span class="n">XRefRole</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">process_link</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">env</span><span class="p">:</span> <span class="n">BuildEnvironment</span><span class="p">,</span> <span class="n">refnode</span><span class="p">:</span> <span class="n">Element</span><span class="p">,</span>
                     <span class="n">has_explicit_title</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">title</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
        <span class="n">refnode</span><span class="p">[</span><span class="s1">&#39;py:module&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">ref_context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;py:module&#39;</span><span class="p">)</span>
        <span class="n">refnode</span><span class="p">[</span><span class="s1">&#39;py:class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">ref_context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;py:class&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">has_explicit_title</span><span class="p">:</span>
            <span class="n">title</span> <span class="o">=</span> <span class="n">title</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>    <span class="c1"># only has a meaning for the target</span>
            <span class="n">target</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;~&#39;</span><span class="p">)</span>  <span class="c1"># only has a meaning for the title</span>
            <span class="c1"># if the first character is a tilde, don&#39;t display the module/class</span>
            <span class="c1"># parts of the contents</span>
            <span class="k">if</span> <span class="n">title</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;~&#39;</span><span class="p">:</span>
                <span class="n">title</span> <span class="o">=</span> <span class="n">title</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
                <span class="n">dot</span> <span class="o">=</span> <span class="n">title</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">dot</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">title</span> <span class="o">=</span> <span class="n">title</span><span class="p">[</span><span class="n">dot</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]</span>
        <span class="c1"># if the first character is a dot, search more specific namespaces first</span>
        <span class="c1"># else search builtins first</span>
        <span class="k">if</span> <span class="n">target</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;.&#39;</span><span class="p">:</span>
            <span class="n">target</span> <span class="o">=</span> <span class="n">target</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="n">refnode</span><span class="p">[</span><span class="s1">&#39;refspecific&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="n">title</span><span class="p">,</span> <span class="n">target</span>


<span class="k">def</span><span class="w"> </span><span class="nf">filter_meta_fields</span><span class="p">(</span><span class="n">app</span><span class="p">:</span> <span class="n">Sphinx</span><span class="p">,</span> <span class="n">domain</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">objtype</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="n">Element</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Filter ``:meta:`` field from its docstring.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">domain</span> <span class="o">!=</span> <span class="s1">&#39;py&#39;</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">content</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">nodes</span><span class="o">.</span><span class="n">field_list</span><span class="p">):</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="nb">list</span><span class="p">[</span><span class="n">nodes</span><span class="o">.</span><span class="n">field</span><span class="p">],</span> <span class="n">node</span><span class="p">)</span>
            <span class="c1"># removing list items while iterating the list needs reversed()</span>
            <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">fields</span><span class="p">):</span>
                <span class="n">field_name</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">nodes</span><span class="o">.</span><span class="n">field_body</span><span class="p">,</span> <span class="n">field</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">astext</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">field_name</span> <span class="o">==</span> <span class="s1">&#39;meta&#39;</span> <span class="ow">or</span> <span class="n">field_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;meta &#39;</span><span class="p">):</span>
                    <span class="n">node</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>


<span class="k">class</span><span class="w"> </span><span class="nc">PythonModuleIndex</span><span class="p">(</span><span class="n">Index</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Index subclass to provide the Python module index.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;modindex&#39;</span>
    <span class="n">localname</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Python Module Index&#39;</span><span class="p">)</span>
    <span class="n">shortname</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;modules&#39;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">docnames</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">IndexEntry</span><span class="p">]]],</span> <span class="nb">bool</span><span class="p">]:</span>
        <span class="n">content</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">IndexEntry</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># list of prefixes to ignore</span>
        <span class="n">ignores</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;modindex_common_prefix&#39;</span><span class="p">]</span>
        <span class="n">ignores</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">ignores</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="nb">len</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># list of all modules, sorted by module name</span>
        <span class="n">modules</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">domain</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;modules&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span>
                         <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
        <span class="c1"># sort out collapsible modules</span>
        <span class="n">prev_modname</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">num_toplevels</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">modname</span><span class="p">,</span> <span class="p">(</span><span class="n">docname</span><span class="p">,</span> <span class="n">node_id</span><span class="p">,</span> <span class="n">synopsis</span><span class="p">,</span> <span class="n">platforms</span><span class="p">,</span> <span class="n">deprecated</span><span class="p">)</span> <span class="ow">in</span> <span class="n">modules</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">docnames</span> <span class="ow">and</span> <span class="n">docname</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">docnames</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="k">for</span> <span class="n">ignore</span> <span class="ow">in</span> <span class="n">ignores</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">modname</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">ignore</span><span class="p">):</span>
                    <span class="n">modname</span> <span class="o">=</span> <span class="n">modname</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">ignore</span><span class="p">):]</span>
                    <span class="n">stripped</span> <span class="o">=</span> <span class="n">ignore</span>
                    <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">stripped</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

            <span class="c1"># we stripped the whole module name?</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">modname</span><span class="p">:</span>
                <span class="n">modname</span><span class="p">,</span> <span class="n">stripped</span> <span class="o">=</span> <span class="n">stripped</span><span class="p">,</span> <span class="s1">&#39;&#39;</span>

            <span class="n">entries</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">modname</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="p">[])</span>

            <span class="n">package</span> <span class="o">=</span> <span class="n">modname</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">package</span> <span class="o">!=</span> <span class="n">modname</span><span class="p">:</span>
                <span class="c1"># it&#39;s a submodule</span>
                <span class="k">if</span> <span class="n">prev_modname</span> <span class="o">==</span> <span class="n">package</span><span class="p">:</span>
                    <span class="c1"># first submodule - make parent a group head</span>
                    <span class="k">if</span> <span class="n">entries</span><span class="p">:</span>
                        <span class="n">last</span> <span class="o">=</span> <span class="n">entries</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                        <span class="n">entries</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">IndexEntry</span><span class="p">(</span><span class="n">last</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="n">last</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">last</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
                                                 <span class="n">last</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">last</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">last</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
                <span class="k">elif</span> <span class="ow">not</span> <span class="n">prev_modname</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">package</span><span class="p">):</span>
                    <span class="c1"># submodule without parent in list, add dummy entry</span>
                    <span class="n">entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">IndexEntry</span><span class="p">(</span><span class="n">stripped</span> <span class="o">+</span> <span class="n">package</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
                <span class="n">subtype</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">num_toplevels</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">subtype</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="n">qualifier</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Deprecated&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">deprecated</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
            <span class="n">entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">IndexEntry</span><span class="p">(</span><span class="n">stripped</span> <span class="o">+</span> <span class="n">modname</span><span class="p">,</span> <span class="n">subtype</span><span class="p">,</span> <span class="n">docname</span><span class="p">,</span>
                                      <span class="n">node_id</span><span class="p">,</span> <span class="n">platforms</span><span class="p">,</span> <span class="n">qualifier</span><span class="p">,</span> <span class="n">synopsis</span><span class="p">))</span>
            <span class="n">prev_modname</span> <span class="o">=</span> <span class="n">modname</span>

        <span class="c1"># apply heuristics when to collapse modindex at page load:</span>
        <span class="c1"># only collapse if number of toplevel modules is larger than</span>
        <span class="c1"># number of submodules</span>
        <span class="n">collapse</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">modules</span><span class="p">)</span> <span class="o">-</span> <span class="n">num_toplevels</span> <span class="o">&lt;</span> <span class="n">num_toplevels</span>

        <span class="c1"># sort by first letter</span>
        <span class="n">sorted_content</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">content</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>

        <span class="k">return</span> <span class="n">sorted_content</span><span class="p">,</span> <span class="n">collapse</span>


<div class="viewcode-block" id="PythonDomain">
<a class="viewcode-back" href="../../../extdev/domainapi.html#sphinx.domains.python.PythonDomain">[文件]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">PythonDomain</span><span class="p">(</span><span class="n">Domain</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Python language domain.&quot;&quot;&quot;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;py&#39;</span>
    <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Python&#39;</span>
    <span class="n">object_types</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ObjType</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;function&#39;</span><span class="p">:</span>     <span class="n">ObjType</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;function&#39;</span><span class="p">),</span>      <span class="s1">&#39;func&#39;</span><span class="p">,</span> <span class="s1">&#39;obj&#39;</span><span class="p">),</span>
        <span class="s1">&#39;data&#39;</span><span class="p">:</span>         <span class="n">ObjType</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">),</span>          <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;obj&#39;</span><span class="p">),</span>
        <span class="s1">&#39;class&#39;</span><span class="p">:</span>        <span class="n">ObjType</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;class&#39;</span><span class="p">),</span>         <span class="s1">&#39;class&#39;</span><span class="p">,</span> <span class="s1">&#39;exc&#39;</span><span class="p">,</span> <span class="s1">&#39;obj&#39;</span><span class="p">),</span>
        <span class="s1">&#39;exception&#39;</span><span class="p">:</span>    <span class="n">ObjType</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;exception&#39;</span><span class="p">),</span>     <span class="s1">&#39;exc&#39;</span><span class="p">,</span> <span class="s1">&#39;class&#39;</span><span class="p">,</span> <span class="s1">&#39;obj&#39;</span><span class="p">),</span>
        <span class="s1">&#39;method&#39;</span><span class="p">:</span>       <span class="n">ObjType</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;method&#39;</span><span class="p">),</span>        <span class="s1">&#39;meth&#39;</span><span class="p">,</span> <span class="s1">&#39;obj&#39;</span><span class="p">),</span>
        <span class="s1">&#39;classmethod&#39;</span><span class="p">:</span>  <span class="n">ObjType</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;class method&#39;</span><span class="p">),</span>  <span class="s1">&#39;meth&#39;</span><span class="p">,</span> <span class="s1">&#39;obj&#39;</span><span class="p">),</span>
        <span class="s1">&#39;staticmethod&#39;</span><span class="p">:</span> <span class="n">ObjType</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;static method&#39;</span><span class="p">),</span> <span class="s1">&#39;meth&#39;</span><span class="p">,</span> <span class="s1">&#39;obj&#39;</span><span class="p">),</span>
        <span class="s1">&#39;attribute&#39;</span><span class="p">:</span>    <span class="n">ObjType</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;attribute&#39;</span><span class="p">),</span>     <span class="s1">&#39;attr&#39;</span><span class="p">,</span> <span class="s1">&#39;obj&#39;</span><span class="p">),</span>
        <span class="s1">&#39;property&#39;</span><span class="p">:</span>     <span class="n">ObjType</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;property&#39;</span><span class="p">),</span>      <span class="s1">&#39;attr&#39;</span><span class="p">,</span> <span class="s1">&#39;_prop&#39;</span><span class="p">,</span> <span class="s1">&#39;obj&#39;</span><span class="p">),</span>
        <span class="s1">&#39;type&#39;</span><span class="p">:</span>         <span class="n">ObjType</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;type alias&#39;</span><span class="p">),</span>    <span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="s1">&#39;obj&#39;</span><span class="p">),</span>
        <span class="s1">&#39;module&#39;</span><span class="p">:</span>       <span class="n">ObjType</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;module&#39;</span><span class="p">),</span>        <span class="s1">&#39;mod&#39;</span><span class="p">,</span> <span class="s1">&#39;obj&#39;</span><span class="p">),</span>
    <span class="p">}</span>

    <span class="n">directives</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;function&#39;</span><span class="p">:</span>        <span class="n">PyFunction</span><span class="p">,</span>
        <span class="s1">&#39;data&#39;</span><span class="p">:</span>            <span class="n">PyVariable</span><span class="p">,</span>
        <span class="s1">&#39;class&#39;</span><span class="p">:</span>           <span class="n">PyClasslike</span><span class="p">,</span>
        <span class="s1">&#39;exception&#39;</span><span class="p">:</span>       <span class="n">PyClasslike</span><span class="p">,</span>
        <span class="s1">&#39;method&#39;</span><span class="p">:</span>          <span class="n">PyMethod</span><span class="p">,</span>
        <span class="s1">&#39;classmethod&#39;</span><span class="p">:</span>     <span class="n">PyClassMethod</span><span class="p">,</span>
        <span class="s1">&#39;staticmethod&#39;</span><span class="p">:</span>    <span class="n">PyStaticMethod</span><span class="p">,</span>
        <span class="s1">&#39;attribute&#39;</span><span class="p">:</span>       <span class="n">PyAttribute</span><span class="p">,</span>
        <span class="s1">&#39;property&#39;</span><span class="p">:</span>        <span class="n">PyProperty</span><span class="p">,</span>
        <span class="s1">&#39;type&#39;</span><span class="p">:</span>            <span class="n">PyTypeAlias</span><span class="p">,</span>
        <span class="s1">&#39;module&#39;</span><span class="p">:</span>          <span class="n">PyModule</span><span class="p">,</span>
        <span class="s1">&#39;currentmodule&#39;</span><span class="p">:</span>   <span class="n">PyCurrentModule</span><span class="p">,</span>
        <span class="s1">&#39;decorator&#39;</span><span class="p">:</span>       <span class="n">PyDecoratorFunction</span><span class="p">,</span>
        <span class="s1">&#39;decoratormethod&#39;</span><span class="p">:</span> <span class="n">PyDecoratorMethod</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">roles</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;data&#39;</span><span class="p">:</span>  <span class="n">PyXRefRole</span><span class="p">(),</span>
        <span class="s1">&#39;exc&#39;</span><span class="p">:</span>   <span class="n">PyXRefRole</span><span class="p">(),</span>
        <span class="s1">&#39;func&#39;</span><span class="p">:</span>  <span class="n">PyXRefRole</span><span class="p">(</span><span class="n">fix_parens</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="n">PyXRefRole</span><span class="p">(),</span>
        <span class="s1">&#39;const&#39;</span><span class="p">:</span> <span class="n">PyXRefRole</span><span class="p">(),</span>
        <span class="s1">&#39;attr&#39;</span><span class="p">:</span>  <span class="n">PyXRefRole</span><span class="p">(),</span>
        <span class="s1">&#39;type&#39;</span><span class="p">:</span>  <span class="n">PyXRefRole</span><span class="p">(),</span>
        <span class="s1">&#39;meth&#39;</span><span class="p">:</span>  <span class="n">PyXRefRole</span><span class="p">(</span><span class="n">fix_parens</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="s1">&#39;mod&#39;</span><span class="p">:</span>   <span class="n">PyXRefRole</span><span class="p">(),</span>
        <span class="s1">&#39;obj&#39;</span><span class="p">:</span>   <span class="n">PyXRefRole</span><span class="p">(),</span>
    <span class="p">}</span>
    <span class="n">initial_data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;objects&#39;</span><span class="p">:</span> <span class="p">{},</span>  <span class="c1"># fullname -&gt; docname, objtype</span>
        <span class="s1">&#39;modules&#39;</span><span class="p">:</span> <span class="p">{},</span>  <span class="c1"># modname -&gt; docname, synopsis, platform, deprecated</span>
    <span class="p">}</span>
    <span class="n">indices</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">PythonModuleIndex</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">objects</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ObjectEntry</span><span class="p">]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;objects&#39;</span><span class="p">,</span> <span class="p">{})</span>  <span class="c1"># fullname -&gt; ObjectEntry</span>

<div class="viewcode-block" id="PythonDomain.note_object">
<a class="viewcode-back" href="../../../extdev/domainapi.html#sphinx.domains.python.PythonDomain.note_object">[文件]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">note_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">objtype</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">node_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                    <span class="n">aliased</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">location</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Note a python object for cross reference.</span>

<span class="sd">        .. versionadded:: 2.1</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">:</span>
            <span class="n">other</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">aliased</span> <span class="ow">and</span> <span class="n">aliased</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="c1"># The original definition found. Override it!</span>
                <span class="k">pass</span>
            <span class="k">elif</span> <span class="n">other</span><span class="o">.</span><span class="n">aliased</span> <span class="ow">is</span> <span class="kc">False</span> <span class="ow">and</span> <span class="n">aliased</span><span class="p">:</span>
                <span class="c1"># The original definition is already registered.</span>
                <span class="k">return</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># duplicated</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">__</span><span class="p">(</span><span class="s1">&#39;duplicate object description of </span><span class="si">%s</span><span class="s1">, &#39;</span>
                                  <span class="s1">&#39;other instance in </span><span class="si">%s</span><span class="s1">, use :no-index: for one of them&#39;</span><span class="p">),</span>
                               <span class="n">name</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">docname</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="n">location</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">ObjectEntry</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">docname</span><span class="p">,</span> <span class="n">node_id</span><span class="p">,</span> <span class="n">objtype</span><span class="p">,</span> <span class="n">aliased</span><span class="p">)</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">modules</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ModuleEntry</span><span class="p">]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;modules&#39;</span><span class="p">,</span> <span class="p">{})</span>  <span class="c1"># modname -&gt; ModuleEntry</span>

<div class="viewcode-block" id="PythonDomain.note_module">
<a class="viewcode-back" href="../../../extdev/domainapi.html#sphinx.domains.python.PythonDomain.note_module">[文件]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">note_module</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">node_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">synopsis</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                    <span class="n">platform</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">deprecated</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Note a python module for cross reference.</span>

<span class="sd">        .. versionadded:: 2.1</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">ModuleEntry</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">docname</span><span class="p">,</span> <span class="n">node_id</span><span class="p">,</span>
                                         <span class="n">synopsis</span><span class="p">,</span> <span class="n">platform</span><span class="p">,</span> <span class="n">deprecated</span><span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">clear_doc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">docname</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">fullname</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">docname</span> <span class="o">==</span> <span class="n">docname</span><span class="p">:</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">fullname</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">modname</span><span class="p">,</span> <span class="n">mod</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">mod</span><span class="o">.</span><span class="n">docname</span> <span class="o">==</span> <span class="n">docname</span><span class="p">:</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">modname</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">merge_domaindata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">docnames</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">otherdata</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># XXX check duplicates?</span>
        <span class="k">for</span> <span class="n">fullname</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">otherdata</span><span class="p">[</span><span class="s1">&#39;objects&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">docname</span> <span class="ow">in</span> <span class="n">docnames</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">fullname</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span>
        <span class="k">for</span> <span class="n">modname</span><span class="p">,</span> <span class="n">mod</span> <span class="ow">in</span> <span class="n">otherdata</span><span class="p">[</span><span class="s1">&#39;modules&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">mod</span><span class="o">.</span><span class="n">docname</span> <span class="ow">in</span> <span class="n">docnames</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">modname</span><span class="p">]</span> <span class="o">=</span> <span class="n">mod</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">find_obj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">env</span><span class="p">:</span> <span class="n">BuildEnvironment</span><span class="p">,</span> <span class="n">modname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">classname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                 <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="n">searchmode</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
                 <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ObjectEntry</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Find a Python object for &quot;name&quot;, perhaps using the given module</span>
<span class="sd">        and/or classname.  Returns a list of (name, object entry) tuples.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># skip parens</span>
        <span class="k">if</span> <span class="n">name</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span> <span class="o">==</span> <span class="s1">&#39;()&#39;</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="n">matches</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ObjectEntry</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">newname</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">searchmode</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">objtypes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">object_types</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">objtypes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">objtypes_for_role</span><span class="p">(</span><span class="nb">type</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">objtypes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">modname</span> <span class="ow">and</span> <span class="n">classname</span><span class="p">:</span>
                    <span class="n">fullname</span> <span class="o">=</span> <span class="n">modname</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">classname</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">name</span>
                    <span class="k">if</span> <span class="n">fullname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">objects</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">fullname</span><span class="p">]</span><span class="o">.</span><span class="n">objtype</span> <span class="ow">in</span> <span class="n">objtypes</span><span class="p">:</span>
                        <span class="n">newname</span> <span class="o">=</span> <span class="n">fullname</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">newname</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">modname</span> <span class="ow">and</span> <span class="n">modname</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">objects</span> <span class="ow">and</span> \
                       <span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">modname</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">objtype</span> <span class="ow">in</span> <span class="n">objtypes</span><span class="p">:</span>
                        <span class="n">newname</span> <span class="o">=</span> <span class="n">modname</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">name</span>
                    <span class="k">elif</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">objects</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">objtype</span> <span class="ow">in</span> <span class="n">objtypes</span><span class="p">:</span>
                        <span class="n">newname</span> <span class="o">=</span> <span class="n">name</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># &quot;fuzzy&quot; searching mode</span>
                        <span class="n">searchname</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">name</span>
                        <span class="n">matches</span> <span class="o">=</span> <span class="p">[(</span><span class="n">oname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">oname</span><span class="p">])</span> <span class="k">for</span> <span class="n">oname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">objects</span>
                                   <span class="k">if</span> <span class="n">oname</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">searchname</span><span class="p">)</span> <span class="ow">and</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">oname</span><span class="p">]</span><span class="o">.</span><span class="n">objtype</span> <span class="ow">in</span> <span class="n">objtypes</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># NOTE: searching for exact match, object type is not considered</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">:</span>
                <span class="n">newname</span> <span class="o">=</span> <span class="n">name</span>
            <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">&#39;mod&#39;</span><span class="p">:</span>
                <span class="c1"># only exact matches allowed for modules</span>
                <span class="k">return</span> <span class="p">[]</span>
            <span class="k">elif</span> <span class="n">classname</span> <span class="ow">and</span> <span class="n">classname</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">:</span>
                <span class="n">newname</span> <span class="o">=</span> <span class="n">classname</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">name</span>
            <span class="k">elif</span> <span class="n">modname</span> <span class="ow">and</span> <span class="n">modname</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">:</span>
                <span class="n">newname</span> <span class="o">=</span> <span class="n">modname</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">name</span>
            <span class="k">elif</span> <span class="n">modname</span> <span class="ow">and</span> <span class="n">classname</span> <span class="ow">and</span> \
                    <span class="n">modname</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">classname</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">:</span>
                <span class="n">newname</span> <span class="o">=</span> <span class="n">modname</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">classname</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">name</span>
        <span class="k">if</span> <span class="n">newname</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">matches</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">newname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="p">[</span><span class="n">newname</span><span class="p">]))</span>
        <span class="k">return</span> <span class="n">matches</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">resolve_xref</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">env</span><span class="p">:</span> <span class="n">BuildEnvironment</span><span class="p">,</span> <span class="n">fromdocname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">builder</span><span class="p">:</span> <span class="n">Builder</span><span class="p">,</span>
                     <span class="nb">type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">pending_xref</span><span class="p">,</span> <span class="n">contnode</span><span class="p">:</span> <span class="n">Element</span><span class="p">,</span>
                     <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Element</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">modname</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;py:module&#39;</span><span class="p">)</span>
        <span class="n">clsname</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;py:class&#39;</span><span class="p">)</span>
        <span class="n">searchmode</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">hasattr</span><span class="p">(</span><span class="s1">&#39;refspecific&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="n">matches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_obj</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">modname</span><span class="p">,</span> <span class="n">clsname</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span>
                                <span class="nb">type</span><span class="p">,</span> <span class="n">searchmode</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">matches</span> <span class="ow">and</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">&#39;attr&#39;</span><span class="p">:</span>
            <span class="c1"># fallback to meth (for property; Sphinx 2.4.x)</span>
            <span class="c1"># this ensures that `:attr:` role continues to refer to the old property entry</span>
            <span class="c1"># that defined by ``method`` directive in old reST files.</span>
            <span class="n">matches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_obj</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">modname</span><span class="p">,</span> <span class="n">clsname</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="s1">&#39;meth&#39;</span><span class="p">,</span> <span class="n">searchmode</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">matches</span> <span class="ow">and</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">&#39;meth&#39;</span><span class="p">:</span>
            <span class="c1"># fallback to attr (for property)</span>
            <span class="c1"># this ensures that `:meth:` in the old reST files can refer to the property</span>
            <span class="c1"># entry that defined by ``property`` directive.</span>
            <span class="c1">#</span>
            <span class="c1"># Note: _prop is a secret role only for internal look-up.</span>
            <span class="n">matches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_obj</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">modname</span><span class="p">,</span> <span class="n">clsname</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="s1">&#39;_prop&#39;</span><span class="p">,</span> <span class="n">searchmode</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">matches</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">canonicals</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">matches</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">aliased</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">canonicals</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">matches</span> <span class="o">=</span> <span class="n">canonicals</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">__</span><span class="p">(</span><span class="s1">&#39;more than one target found for cross-reference </span><span class="si">%r</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">),</span>
                               <span class="n">target</span><span class="p">,</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">match</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">),</span>
                               <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;ref&#39;</span><span class="p">,</span> <span class="n">subtype</span><span class="o">=</span><span class="s1">&#39;python&#39;</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="n">node</span><span class="p">)</span>
        <span class="n">name</span><span class="p">,</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">matches</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">obj</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;module&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_module_refnode</span><span class="p">(</span><span class="n">builder</span><span class="p">,</span> <span class="n">fromdocname</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">contnode</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># determine the content of the reference by conditions</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">find_pending_xref_condition</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s1">&#39;resolved&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">content</span><span class="p">:</span>
                <span class="n">children</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">children</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># if not found, use contnode</span>
                <span class="n">children</span> <span class="o">=</span> <span class="p">[</span><span class="n">contnode</span><span class="p">]</span>

            <span class="k">return</span> <span class="n">make_refnode</span><span class="p">(</span><span class="n">builder</span><span class="p">,</span> <span class="n">fromdocname</span><span class="p">,</span> <span class="n">obj</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">obj</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">children</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">resolve_any_xref</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">env</span><span class="p">:</span> <span class="n">BuildEnvironment</span><span class="p">,</span> <span class="n">fromdocname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">builder</span><span class="p">:</span> <span class="n">Builder</span><span class="p">,</span>
                         <span class="n">target</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">pending_xref</span><span class="p">,</span> <span class="n">contnode</span><span class="p">:</span> <span class="n">Element</span><span class="p">,</span>
                         <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Element</span><span class="p">]]:</span>
        <span class="n">modname</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;py:module&#39;</span><span class="p">)</span>
        <span class="n">clsname</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;py:class&#39;</span><span class="p">)</span>
        <span class="n">results</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Element</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># always search in &quot;refspecific&quot; mode with the :any: role</span>
        <span class="n">matches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_obj</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">modname</span><span class="p">,</span> <span class="n">clsname</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">multiple_matches</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span>

        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">multiple_matches</span> <span class="ow">and</span> <span class="n">obj</span><span class="o">.</span><span class="n">aliased</span><span class="p">:</span>
                <span class="c1"># Skip duplicated matches</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="n">obj</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;module&#39;</span><span class="p">:</span>
                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;py:mod&#39;</span><span class="p">,</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">_make_module_refnode</span><span class="p">(</span><span class="n">builder</span><span class="p">,</span> <span class="n">fromdocname</span><span class="p">,</span>
                                                          <span class="n">name</span><span class="p">,</span> <span class="n">contnode</span><span class="p">)))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># determine the content of the reference by conditions</span>
                <span class="n">content</span> <span class="o">=</span> <span class="n">find_pending_xref_condition</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s1">&#39;resolved&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">content</span><span class="p">:</span>
                    <span class="n">children</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">children</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># if not found, use contnode</span>
                    <span class="n">children</span> <span class="o">=</span> <span class="p">[</span><span class="n">contnode</span><span class="p">]</span>

                <span class="n">role</span> <span class="o">=</span> <span class="s1">&#39;py:&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">role_for_objtype</span><span class="p">(</span><span class="n">obj</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>  <span class="c1"># type: ignore[operator]</span>
                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">role</span><span class="p">,</span> <span class="n">make_refnode</span><span class="p">(</span><span class="n">builder</span><span class="p">,</span> <span class="n">fromdocname</span><span class="p">,</span> <span class="n">obj</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">obj</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                                   <span class="n">children</span><span class="p">,</span> <span class="n">name</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">results</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_make_module_refnode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">builder</span><span class="p">:</span> <span class="n">Builder</span><span class="p">,</span> <span class="n">fromdocname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                             <span class="n">contnode</span><span class="p">:</span> <span class="n">Node</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Element</span><span class="p">:</span>
        <span class="c1"># get additional info for modules</span>
        <span class="n">module</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">name</span>
        <span class="k">if</span> <span class="n">module</span><span class="o">.</span><span class="n">synopsis</span><span class="p">:</span>
            <span class="n">title</span> <span class="o">+=</span> <span class="s1">&#39;: &#39;</span> <span class="o">+</span> <span class="n">module</span><span class="o">.</span><span class="n">synopsis</span>
        <span class="k">if</span> <span class="n">module</span><span class="o">.</span><span class="n">deprecated</span><span class="p">:</span>
            <span class="n">title</span> <span class="o">+=</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39; (deprecated)&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">module</span><span class="o">.</span><span class="n">platform</span><span class="p">:</span>
            <span class="n">title</span> <span class="o">+=</span> <span class="s1">&#39; (&#39;</span> <span class="o">+</span> <span class="n">module</span><span class="o">.</span><span class="n">platform</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
        <span class="k">return</span> <span class="n">make_refnode</span><span class="p">(</span><span class="n">builder</span><span class="p">,</span> <span class="n">fromdocname</span><span class="p">,</span> <span class="n">module</span><span class="o">.</span><span class="n">docname</span><span class="p">,</span> <span class="n">module</span><span class="o">.</span><span class="n">node_id</span><span class="p">,</span>
                            <span class="n">contnode</span><span class="p">,</span> <span class="n">title</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_objects</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
        <span class="k">for</span> <span class="n">modname</span><span class="p">,</span> <span class="n">mod</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">yield</span> <span class="p">(</span><span class="n">modname</span><span class="p">,</span> <span class="n">modname</span><span class="p">,</span> <span class="s1">&#39;module&#39;</span><span class="p">,</span> <span class="n">mod</span><span class="o">.</span><span class="n">docname</span><span class="p">,</span> <span class="n">mod</span><span class="o">.</span><span class="n">node_id</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">refname</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">objtype</span> <span class="o">!=</span> <span class="s1">&#39;module&#39;</span><span class="p">:</span>  <span class="c1"># modules are already handled</span>
                <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">aliased</span><span class="p">:</span>
                    <span class="c1"># aliased names are not full-text searchable.</span>
                    <span class="k">yield</span> <span class="p">(</span><span class="n">refname</span><span class="p">,</span> <span class="n">refname</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">objtype</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">docname</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">node_id</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">yield</span> <span class="p">(</span><span class="n">refname</span><span class="p">,</span> <span class="n">refname</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">objtype</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">docname</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">node_id</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_full_qualified_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">Element</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">modname</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;py:module&#39;</span><span class="p">)</span>
        <span class="n">clsname</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;py:class&#39;</span><span class="p">)</span>
        <span class="n">target</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;reftarget&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">target</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="p">[</span><span class="n">modname</span><span class="p">,</span> <span class="n">clsname</span><span class="p">,</span> <span class="n">target</span><span class="p">]))</span></div>



<span class="k">def</span><span class="w"> </span><span class="nf">builtin_resolver</span><span class="p">(</span><span class="n">app</span><span class="p">:</span> <span class="n">Sphinx</span><span class="p">,</span> <span class="n">env</span><span class="p">:</span> <span class="n">BuildEnvironment</span><span class="p">,</span>
                     <span class="n">node</span><span class="p">:</span> <span class="n">pending_xref</span><span class="p">,</span> <span class="n">contnode</span><span class="p">:</span> <span class="n">Element</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Element</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Do not emit nitpicky warnings for built-in types.&quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">istyping</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;typing.&#39;</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">typing</span><span class="o">.</span><span class="n">__all__</span>

    <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;refdomain&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">&#39;py&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">elif</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;reftype&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;class&#39;</span><span class="p">,</span> <span class="s1">&#39;obj&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;reftarget&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">contnode</span>
    <span class="k">elif</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;reftype&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;class&#39;</span><span class="p">,</span> <span class="s1">&#39;obj&#39;</span><span class="p">,</span> <span class="s1">&#39;exc&#39;</span><span class="p">):</span>
        <span class="n">reftarget</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;reftarget&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isclass</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">builtins</span><span class="p">,</span> <span class="n">reftarget</span><span class="p">,</span> <span class="kc">None</span><span class="p">)):</span>
            <span class="c1"># built-in class</span>
            <span class="k">return</span> <span class="n">contnode</span>
        <span class="k">if</span> <span class="n">istyping</span><span class="p">(</span><span class="n">reftarget</span><span class="p">):</span>
            <span class="c1"># typing class</span>
            <span class="k">return</span> <span class="n">contnode</span>

    <span class="k">return</span> <span class="kc">None</span>


<span class="k">def</span><span class="w"> </span><span class="nf">setup</span><span class="p">(</span><span class="n">app</span><span class="p">:</span> <span class="n">Sphinx</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ExtensionMetadata</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">setup_extension</span><span class="p">(</span><span class="s1">&#39;sphinx.directives&#39;</span><span class="p">)</span>

    <span class="n">app</span><span class="o">.</span><span class="n">add_domain</span><span class="p">(</span><span class="n">PythonDomain</span><span class="p">)</span>
    <span class="n">app</span><span class="o">.</span><span class="n">add_config_value</span><span class="p">(</span><span class="s1">&#39;python_use_unqualified_type_names&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;env&#39;</span><span class="p">)</span>
    <span class="n">app</span><span class="o">.</span><span class="n">add_config_value</span><span class="p">(</span>
        <span class="s1">&#39;python_maximum_signature_line_length&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;env&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nb">int</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)},</span>
    <span class="p">)</span>
    <span class="n">app</span><span class="o">.</span><span class="n">add_config_value</span><span class="p">(</span><span class="s1">&#39;python_display_short_literal_types&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;env&#39;</span><span class="p">)</span>
    <span class="n">app</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;object-description-transform&#39;</span><span class="p">,</span> <span class="n">filter_meta_fields</span><span class="p">)</span>
    <span class="n">app</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;missing-reference&#39;</span><span class="p">,</span> <span class="n">builtin_resolver</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">900</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;version&#39;</span><span class="p">:</span> <span class="s1">&#39;builtin&#39;</span><span class="p">,</span>
        <span class="s1">&#39;env_version&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
        <span class="s1">&#39;parallel_read_safe&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">&#39;parallel_write_safe&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">}</span>
</pre></div>

    
  <div class="related-pages" role="navigation" aria-label="Related">
    
    <div></div>
    
  </div>

  </div>
</div>
<div class="footer" role="contentinfo">
  
    &#169; 版權所有 2007-2026, the Sphinx developers.
  使用 <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.4.7 建立。
</div>
  </body>
</html>