
<!DOCTYPE html>

<html lang="zh-TW">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>sphinx.locale &#8212; Sphinx documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/basic.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx13.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/translations.js"></script>
    <link rel="canonical" href="https://projects.localizethedocs.org/sphinx-docs-l10n/_modules/sphinx/locale.html" />
    <link rel="search" type="application/opensearchdescription+xml"
          title="在 Sphinx documentation 中搜尋"
          href="../../_static/opensearch.xml"/>
    <link rel="icon" href="../../_static/favicon.svg"/>
    <link rel="index" title="索引" href="../../genindex.html" />
    <link rel="search" title="搜尋" href="../../search.html" />

 

<script type="text/javascript" src="../../ltd-provenance.js"></script>
<script type="text/javascript" src="../../ltd-current.js"></script>
<script type="text/javascript" src="../../../../ltd-config.js"></script>
<script type="text/javascript" src="../../../../ltd-flyout.js"></script>

  </head><body>
<div class="pageheader">
<a href="../../index.html">
  <img src="../../_static/sphinxheader.png" alt="SPHINX" />
</a>
</div>

<div class="related" role="navigation" aria-label="related navigation">
  <h3>瀏覽</h3>
  <ul>
    <li><a href="../../index.html">Documentation</a> &raquo;</li>
      <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">模組原始碼</a> &#187;</li>
    <li class="nav-item nav-item-this"><a href="">sphinx.locale</a></li>
  </ul>
</div>

<div class="document">
  <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
<div id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="前往" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
    <div class="sphinxsidebar-navigation__contents">
      <h3>On this page</h3>
      
    </div>
    <div class="sphinxsidebar-navigation__pages">
      <h3>Site navigation</h3>
      <p class="caption" role="heading"><span class="caption-text">開始使用</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../usage/quickstart.html">開始使用</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usage/installation.html">安裝 Sphinx</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial/index.html">Tutorial: Build your first project</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">使用者指南</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../usage/index.html">使用 Sphinx</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../development/index.html">Writing Sphinx Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../latex.html">LaTeX customization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../extdev/index.html">Sphinx Extensions API</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">社群</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../support.html">獲取支援</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../internals/index.html">貢獻 Sphinx</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq.html">Sphinx 常見問題</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../authors.html">Sphinx 作者群</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">參考手冊</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../man/index.html">命令行工具</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usage/configuration.html">組態</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usage/extensions/index.html">擴充功能</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usage/restructuredtext/index.html">reStructuredText</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary.html">詞彙表</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changes.html">變更日誌</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples.html">使用 Sphinx 的專案</a></li>
</ul>

    </div>
  </div>
  <div class="body" role="main">
    
  <h1>sphinx.locale 的原始碼</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Locale utilities.&quot;&quot;&quot;</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">__future__</span><span class="w"> </span><span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">locale</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">gettext</span><span class="w"> </span><span class="kn">import</span> <span class="n">NullTranslations</span><span class="p">,</span> <span class="n">translation</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">os</span><span class="w"> </span><span class="kn">import</span> <span class="n">path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Callable</span>


<span class="k">class</span><span class="w"> </span><span class="nc">_TranslationProxy</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The proxy implementation attempts to be as complete as possible, so that</span>
<span class="sd">    the lazy objects should mostly work as expected, for example for sorting.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="vm">__slots__</span> <span class="o">=</span> <span class="s1">&#39;_catalogue&#39;</span><span class="p">,</span> <span class="s1">&#39;_namespace&#39;</span><span class="p">,</span> <span class="s1">&#39;_message&#39;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">catalogue</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_catalogue</span> <span class="o">=</span> <span class="n">catalogue</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_namespace</span> <span class="o">=</span> <span class="n">namespace</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_message</span> <span class="o">=</span> <span class="n">message</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">translators</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_namespace</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_catalogue</span><span class="p">]</span><span class="o">.</span><span class="n">gettext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_message</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="c1"># NullTranslations().gettext(self._message) == self._message</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_message</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__dir__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="k">return</span> <span class="nb">dir</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="fm">__str__</span><span class="p">(),</span> <span class="n">name</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_catalogue</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_namespace</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_message</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tup</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_catalogue</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_namespace</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_message</span> <span class="o">=</span> <span class="n">tup</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__copy__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_TranslationProxy</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_TranslationProxy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_catalogue</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_namespace</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_message</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;i</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span><span class="si">!r}</span><span class="s1">&#39;</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
                    <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_catalogue</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_namespace</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_message</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span> <span class="o">+</span> <span class="n">other</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">other</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__mod__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span> <span class="o">%</span> <span class="n">other</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__rmod__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">other</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span> <span class="o">*</span> <span class="n">other</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">other</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="fm">__str__</span><span class="p">())</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span> <span class="o">==</span> <span class="n">other</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">string</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">string</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">char</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">char</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="fm">__str__</span><span class="p">())</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()[</span><span class="n">index</span><span class="p">]</span>


<span class="n">translators</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">NullTranslations</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>


<div class="viewcode-block" id="init"><a class="viewcode-back" href="../../extdev/i18n.html#sphinx.locale.init">[文件]</a><span class="k">def</span><span class="w"> </span><span class="nf">init</span><span class="p">(</span>
    <span class="n">locale_dirs</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">],</span>
    <span class="n">language</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">catalog</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;sphinx&#39;</span><span class="p">,</span>
    <span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;general&#39;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">NullTranslations</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Look for message catalogs in `locale_dirs` and *ensure* that there is at</span>
<span class="sd">    least a NullTranslations catalog set in `translators`. If called multiple</span>
<span class="sd">    times or if several ``.mo`` files are found, their contents are merged</span>
<span class="sd">    together (thus making ``init`` reentrant).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">translator</span> <span class="o">=</span> <span class="n">translators</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="n">namespace</span><span class="p">,</span> <span class="n">catalog</span><span class="p">))</span>
    <span class="c1"># ignore previously failed attempts to find message catalogs</span>
    <span class="k">if</span> <span class="n">translator</span><span class="o">.</span><span class="vm">__class__</span> <span class="ow">is</span> <span class="n">NullTranslations</span><span class="p">:</span>
        <span class="n">translator</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">language</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;_&#39;</span> <span class="ow">in</span> <span class="n">language</span><span class="p">:</span>
            <span class="c1"># for language having country code (like &quot;de_AT&quot;)</span>
            <span class="n">languages</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="p">[</span><span class="n">language</span><span class="p">,</span> <span class="n">language</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">languages</span> <span class="o">=</span> <span class="p">[</span><span class="n">language</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">languages</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># loading</span>
    <span class="c1"># the None entry is the system&#39;s default locale path</span>
    <span class="k">for</span> <span class="n">dir_</span> <span class="ow">in</span> <span class="n">locale_dirs</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">trans</span> <span class="o">=</span> <span class="n">translation</span><span class="p">(</span><span class="n">catalog</span><span class="p">,</span> <span class="n">localedir</span><span class="o">=</span><span class="n">dir_</span><span class="p">,</span> <span class="n">languages</span><span class="o">=</span><span class="n">languages</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">translator</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">translator</span> <span class="o">=</span> <span class="n">trans</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">translator</span><span class="o">.</span><span class="n">add_fallback</span><span class="p">(</span><span class="n">trans</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="c1"># Language couldn&#39;t be found in the specified path</span>
            <span class="k">pass</span>
    <span class="k">if</span> <span class="n">translator</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">has_translation</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">translator</span> <span class="o">=</span> <span class="n">NullTranslations</span><span class="p">()</span>
        <span class="n">has_translation</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="c1"># guarantee translators[(namespace, catalog)] exists</span>
    <span class="n">translators</span><span class="p">[</span><span class="n">namespace</span><span class="p">,</span> <span class="n">catalog</span><span class="p">]</span> <span class="o">=</span> <span class="n">translator</span>
    <span class="k">return</span> <span class="n">translator</span><span class="p">,</span> <span class="n">has_translation</span></div>


<span class="n">_LOCALE_DIR</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>


<div class="viewcode-block" id="init_console"><a class="viewcode-back" href="../../extdev/i18n.html#sphinx.locale.init_console">[文件]</a><span class="k">def</span><span class="w"> </span><span class="nf">init_console</span><span class="p">(</span>
    <span class="n">locale_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">_LOCALE_DIR</span><span class="p">,</span>
    <span class="n">catalog</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;sphinx&#39;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">NullTranslations</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize locale for console.</span>

<span class="sd">    .. versionadded:: 1.8</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># encoding is ignored</span>
        <span class="n">language</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">locale</span><span class="o">.</span><span class="n">getlocale</span><span class="p">(</span><span class="n">locale</span><span class="o">.</span><span class="n">LC_MESSAGES</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="c1"># LC_MESSAGES is not always defined. Fallback to the default language</span>
        <span class="c1"># in case it is not.</span>
        <span class="n">language</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">init</span><span class="p">([</span><span class="n">locale_dir</span><span class="p">],</span> <span class="n">language</span><span class="p">,</span> <span class="n">catalog</span><span class="p">,</span> <span class="s1">&#39;console&#39;</span><span class="p">)</span></div>


<span class="k">def</span><span class="w"> </span><span class="nf">get_translator</span><span class="p">(</span><span class="n">catalog</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;sphinx&#39;</span><span class="p">,</span> <span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;general&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NullTranslations</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">translators</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="n">namespace</span><span class="p">,</span> <span class="n">catalog</span><span class="p">),</span> <span class="n">NullTranslations</span><span class="p">())</span>


<span class="k">def</span><span class="w"> </span><span class="nf">is_translator_registered</span><span class="p">(</span><span class="n">catalog</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;sphinx&#39;</span><span class="p">,</span> <span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;general&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="n">catalog</span><span class="p">)</span> <span class="ow">in</span> <span class="n">translators</span>


<div class="viewcode-block" id="get_translation"><a class="viewcode-back" href="../../extdev/i18n.html#sphinx.locale.get_translation">[文件]</a><span class="k">def</span><span class="w"> </span><span class="nf">get_translation</span><span class="p">(</span><span class="n">catalog</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;general&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get a translation function based on the *catalog* and *namespace*.</span>

<span class="sd">    The extension can use this API to translate the messages on the</span>
<span class="sd">    extension::</span>

<span class="sd">        import os</span>
<span class="sd">        from sphinx.locale import get_translation</span>

<span class="sd">        MESSAGE_CATALOG_NAME = &#39;myextension&#39;  # name of *.pot, *.po and *.mo files</span>
<span class="sd">        _ = get_translation(MESSAGE_CATALOG_NAME)</span>
<span class="sd">        text = _(&#39;Hello Sphinx!&#39;)</span>


<span class="sd">        def setup(app):</span>
<span class="sd">            package_dir = os.path.abspath(os.path.dirname(__file__))</span>
<span class="sd">            locale_dir = os.path.join(package_dir, &#39;locales&#39;)</span>
<span class="sd">            app.add_message_catalog(MESSAGE_CATALOG_NAME, locale_dir)</span>

<span class="sd">    With this code, sphinx searches a message catalog from</span>
<span class="sd">    ``${package_dir}/locales/${language}/LC_MESSAGES/myextension.mo``.</span>
<span class="sd">    The :confval:`language` is used for the searching.</span>

<span class="sd">    .. versionadded:: 1.8</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">gettext</span><span class="p">(</span><span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_translator_registered</span><span class="p">(</span><span class="n">catalog</span><span class="p">,</span> <span class="n">namespace</span><span class="p">):</span>
            <span class="c1"># not initialized yet</span>
            <span class="k">return</span> <span class="n">_TranslationProxy</span><span class="p">(</span><span class="n">catalog</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>  <span class="c1"># type: ignore[return-value]  # noqa: E501</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">translator</span> <span class="o">=</span> <span class="n">get_translator</span><span class="p">(</span><span class="n">catalog</span><span class="p">,</span> <span class="n">namespace</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">translator</span><span class="o">.</span><span class="n">gettext</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">gettext</span></div>


<span class="c1"># A shortcut for sphinx-core</span>
<span class="c1">#: Translation function for messages on documentation (menu, labels, themes and so on).</span>
<span class="c1">#: This function follows :confval:`language` setting.</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">get_translation</span><span class="p">(</span><span class="s1">&#39;sphinx&#39;</span><span class="p">)</span>
<span class="c1">#: Translation function for console messages</span>
<span class="c1">#: This function follows locale setting (`LC_ALL`, `LC_MESSAGES` and so on).</span>
<span class="n">__</span> <span class="o">=</span> <span class="n">get_translation</span><span class="p">(</span><span class="s1">&#39;sphinx&#39;</span><span class="p">,</span> <span class="s1">&#39;console&#39;</span><span class="p">)</span>


<span class="c1"># labels</span>
<span class="n">admonitionlabels</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;attention&#39;</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Attention&#39;</span><span class="p">),</span>
    <span class="s1">&#39;caution&#39;</span><span class="p">:</span>   <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Caution&#39;</span><span class="p">),</span>
    <span class="s1">&#39;danger&#39;</span><span class="p">:</span>    <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Danger&#39;</span><span class="p">),</span>
    <span class="s1">&#39;error&#39;</span><span class="p">:</span>     <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Error&#39;</span><span class="p">),</span>
    <span class="s1">&#39;hint&#39;</span><span class="p">:</span>      <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Hint&#39;</span><span class="p">),</span>
    <span class="s1">&#39;important&#39;</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Important&#39;</span><span class="p">),</span>
    <span class="s1">&#39;note&#39;</span><span class="p">:</span>      <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Note&#39;</span><span class="p">),</span>
    <span class="s1">&#39;seealso&#39;</span><span class="p">:</span>   <span class="n">_</span><span class="p">(</span><span class="s1">&#39;See also&#39;</span><span class="p">),</span>
    <span class="s1">&#39;tip&#39;</span><span class="p">:</span>       <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Tip&#39;</span><span class="p">),</span>
    <span class="s1">&#39;warning&#39;</span><span class="p">:</span>   <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Warning&#39;</span><span class="p">),</span>
<span class="p">}</span>

<span class="c1"># Moved to sphinx.directives.other (will be overridden later)</span>
<span class="n">versionlabels</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

<span class="c1"># Moved to sphinx.domains.python (will be overridden later)</span>
<span class="n">pairindextypes</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</pre></div>

  </div>
</div>
<div class="footer" role="contentinfo">
  &#169; <a href="../../copyright.html">版權所有</a> 2007-2026, the Sphinx developers。
  使用 <a href="https://www.sphinx-doc.org/">Sphinx</a> 6.2.1 建立。
</div>
  </body>
</html>